<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta content="telephone=no" name="format-detection">
<meta name="keywords" content="" />
<meta name="description" content="" />
<title>会员折扣活动</title>
<link type="text/css" rel="stylesheet" href="<!--{$out.new_static_url}-->/activity/vip/discount_css/common.css?v1"/>
<script type="text/javascript"  src="http://img4.anzhi.com/static/public/js/jquery-1.8.0.min.js"></script>
<!--{if $out['is_test'] == 1}-->
<script type="text/javascript" src="/js/debug.js"></script>
<script type="text/javascript" src="/js/pc_soft_list.js"></script>
<!--{/if}-->
<style>
body{background:url(<!--{$out.img_url}--><!--{$out.list.bg_img}-->) no-repeat; background-size:100% 100%}
.menber_card{padding:1.7rem 1.5% 0;background:url(<!--{$out.img_url}--><!--{$out.list.button_pic}-->) no-repeat; background-size:100% 100%}
.soft_list li p{color:<!--{$out.list.sudoku_color}-->}
.soft_list li a{text-indent:-9999em;overflow: hidden; }
.soft_list li a.down_ing{ background: url(<!--{$out.img_url}--><!--{$out.list.download_comment}-->) 0 0 no-repeat;background-size: 100% 100%; }
.soft_list li a.down{ background: url(<!--{$out.img_url}--><!--{$out.list.ap_download_link}-->) 0 0 no-repeat;background-size: 100% 100%; }
.soft_list li a.update{ background: url(<!--{$out.img_url}--><!--{$out.list.update_button_color}-->) 0 0 no-repeat;background-size: 100% 100%; }
.soft_list li a.install{ background: url(<!--{$out.img_url}--><!--{$out.list.my_prize_button_color}-->) 0 0 no-repeat;background-size: 100% 100%; }
.soft_list li a.open{ background: url(<!--{$out.img_url}--><!--{$out.list.my_prize_text_color}-->) 0 0 no-repeat;background-size: 100% 100%; }
.rule_wrap{background:url(<!--{$out.img_url}--><!--{$out.list.rule_pic}-->) no-repeat; background-size:100% 100%; padding:1.1rem 0.4rem 0.4rem;}
.rule_wrap p{color:<!--{$out.list.desc_color}-->;min-height:6rem;}
.share_btn{margin-bottom:0.5rem;}
.share_btn img{display: block; width:100%;z-index:9999;}
.wrap3 img{display: block; width:100%;}
.btns1{background: url(<!--{$out.img_url}--><!--{if $out.is_sdk == 1}--><!--{$out.list.button_comment}--><!--{else}--><!--{$out.list.button_color}--><!--{/if}-->) 0 0 no-repeat;background-size: 100% 100%;}
.tip-box{background:url(<!--{$out.img_url}--><!--{$out.list.lottery_pic}-->) no-repeat; background-size:100% 100%;}
.tip-box .wrap2 p{min-height:4rem;color:<!--{$out.list.mean_text_color}-->}

.btns2{background:url(<!--{$out.img_url}--><!--{$out.list.click_lottery_pic}-->) no-repeat; background-size:100% 100%}
.title1{background:url(<!--{$out.img_url}--><!--{$out.list.soft_bg}-->) no-repeat; background-size:100% 100%}
.change_btn img{display: block; width:0.93rem;}
</style>
<script type="text/javascript">
    (function (doc, win) {
    	var docEl = doc.documentElement,
        resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
        recalc = function () {
            var clientWidth = docEl.clientWidth;
            if (!clientWidth) return;
            if(clientWidth>=640){
				docEl.style.fontSize = '100px';
			}else{
				docEl.style.fontSize = 100 * (clientWidth / 640) + 'px';
			}
        };
	    // Abort if browser does not support addEventListener
	    if (!doc.addEventListener) return;
	    win.addEventListener(resizeEvt, recalc, false);
	    doc.addEventListener('DOMContentLoaded', recalc, false);
	   //以640像素设计图为准 ，1rem代表100像素
	})(document, window);
</script>
</head>
<body>
<div class="banner">
	<img src="<!--{$out.img_url}--><!--{$out.list.ap_imgurl}-->"/>
</div>
<div class='main'>
	<div  onclick="go_vip();">
		<div class="menber_card">
			<div class="clear"></div>
		</div>
		<a href="javascript:;" class="btns btns1"></a>
	</div>
	<div class="menber_good_wrap" onclick="go_vip_detail();">
		<img class="menber_good" src="<!--{$out.img_url}--><!--{$out.list.draw_font_color}-->" />
	</div>
	<div class="wrap">
		<div class="title title1">热门游戏</div>
		<a href="javascript:;" class="change_btn" onclick="change_soft();">
			<img src="<!--{$out.img_url}--><!--{$out.list.describe}-->"/>
		</a>
		<ul class="soft_list clear" id='soft-list'>
			<div class="clear"></div>
		</ul>
	</div>
	<div class="rule_wrap">
		<p>
		<!--{if $out.list.is_score == 2}-->
			<!--{$out.list.ap_rule}-->
		<!--{/if}-->		
		</p>
	</div>
	<div class="share_btn">
		<!--{if $out.is_sdk == 0}-->
		<a href="javascript:;" onclick="go_share();">
			<img src="<!--{$out.img_url}--><!--{$out.list.third_text_color}-->"/>
		</a>
		<!--{/if}-->
	</div>	
</div>

<section>
    <div id="body-bg" style="display: none;"></div>
    <div class="tip-box" id="tip-box1"  style="display: none;">
		<div class="wrap2">
			<div class="title">开通流程</div>
			<span class="close" onclick="cloBox('#tip-box1')"></span>
			<p>
				<!--{if $out.list.is_repeat != 1}-->
					<!--{$out.list.no_marquee}-->
				<!--{/if}-->
			</p>
		</div>
		<div class="wrap3">
			<a href="javascript:;" onclick="cloBox('#tip-box1');">
				<img src="<!--{$out.img_url}--><!--{$out.list.click_lottery_pic}-->"/>
			</a>
		</div>			
    </div>
</section>

</body>
</html>
<script type="text/javascript">
var sid = '<!--{$out.sid}-->';
var aid = '<!--{$out.aid}-->',p=0,soft_lists_go = [],flags={canMove:true};
var version_code = '<!--{$out.version_code}-->';
var prefix = "<!--{$out.prefix}-->";
var type = "<!--{$out.type}-->";
var limit = 8;
var open_pkg_arr = [];
function my_soft() {
	var json_data = window.AnzhiActivitys.getAllAppList(parseInt(aid));
	var cmd = 'var soft_list=' + json_data;
	eval(cmd);
	var soft_lists = soft_list.DATA;
	var open_list = [];
	var install_list = [];
	var down_list = [];
	for(j=0;j<soft_lists.length;j++){
		window.AnzhiActivitys.registerDownloadObserver(parseInt(soft_lists[j][0]));
		window.AnzhiActivitys.registerInstallObserver(soft_lists[j][7]);
		var json_data =  window.AnzhiActivitys.isInstalledApp(soft_lists[j][7],parseInt(soft_lists[j][13]));
		var soft_status_gos = window.AnzhiActivitys.getDownloadStateForActivity(parseInt(soft_lists[j][0]));
		if(json_data == 0 || json_data == 1 ){
			open_list.push(soft_lists[j]);
			open_pkg_arr.push(soft_lists[j][7]);
		}
		if(json_data == -2 && soft_status_gos == 5){
			install_list.push(soft_lists[j]);
		}
		if((json_data == -2 && soft_status_gos != 5 ) || json_data == -1){
			down_list.push(soft_lists[j]);
		}
	}    
	if(j<=4){
		//软件小于等于4个不显示换一换按钮
		$(".soft_title").css('display','none');
	}		
  	for(var ii in open_list) {
		soft_lists_go.push(open_list[ii]);
	}  
  	for(var ii in install_list) {
		soft_lists_go.push(install_list[ii]);
	}
  	for(var ii in down_list) {
		soft_lists_go.push(down_list[ii]);
	}
	get_soft();
}


function get_soft(){
	var pagemax= Math.floor(soft_lists_go.length/limit);
	if(soft_lists_go.length%limit==0){
		pagemax = pagemax-1;
	}
	var data = soft_lists_go.slice(p*limit,limit*(p+1));
	if(data.length == 0){
		p = 0;
		data = soft_lists_go.slice(p*limit,limit*(p+1));
	}

	var str = '';
	for(i = 0; i < data.length; i++) {
		var json_datas = window.AnzhiActivitys.getDownloadStateForActivity(parseInt(data[i][0]));
		var cmd = 'var soft_status=' + json_datas;
		eval(cmd);		
		if(data[i][data[i].length-1] != ''){
			var size = data[i][data[i].length-1];
		}else{
			var size = data[i][27];
		}			
		if(data[i][2].length > 4){
			var softname = data[i][2].substring(0,3)+'...';
		}else{
			var softname = data[i][2];
		}		
		str += get_soft_li(soft_status,parseInt(data[i][0]),data[i][7],softname,parseInt(data[i][13]),size,data[i][1]);

	}
	$('#soft-list').html(str);
	if(p==pagemax){
		p=0;
	}else{
		p=p+1;
	}
}

function get_soft_li(soft_status,softid,my_package,softname,versioncode,size,src){
	if(soft_status == 1){
		var soft_li = '<li id="li_'+softid+'" ><p class="soft_icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn"><a href="javascript:;" class="soft_btn down_ing" >下载中</a></p></li>';
	}else if(soft_status == 2 || soft_status == 3 || soft_status == 8){
		var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft_icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a id="'+softid+'" href="javascript:;" class="soft_btn down" >继续</a></p></li>';
	}else if(soft_status == 4){
		var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft_icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a id="'+softid+'" href="javascript:;" class="soft_btn down"  >下载</a></p></li>';
	}else if(soft_status == 5){
		var soft_li = '<li onclick="installApp('+softid+',\''+my_package+'\')" ><p class="soft_icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn"><a href="javascript:;" class="soft_btn install" >安装</a></p></li>';
	}else if(soft_status == 6){
		var soft_li = '<li onclick="openApp(\''+my_package+'\','+softid+')" ><p class="soft_icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a href="javascript:;" class="soft_btn open"  >打开</a></p></li>';
	}else if(soft_status == 9){
		var soft_li = '<li onclick="installApp('+softid+',\''+my_package+'\')" ><p class="soft_icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a href="javascript:;" class="soft_btn down"  >校验中</a></p></li>';
	}else if(soft_status == 10){
		var soft_li = '<li><p class="soft_icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a id="'+softid+'" href="javascript:;" class="soft_btn install" >已下载</a></p></li>';
	}else if(soft_status == -1){
		var soft_other_status = window.AnzhiActivitys.isInstalledApp(my_package,parseInt(versioncode));
		if(soft_other_status == -2){
			var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft_icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a id="'+softid+'" href="javascript:;" class="soft_btn down"  >下载</a></p></li>';
		}else if(soft_other_status == -1){
			var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft_icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a id="'+softid+'" href="javascript:;" class="soft_btn update"  >更新</a></p></li>';
		}else if(soft_other_status == 0){
			var soft_li = '<li onclick="openApp(\''+my_package+'\','+softid+')" ><p class="soft_icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn" ><a href="javascript:;" class="soft_btn open"  >打开</a></p></li>';
		}else if(soft_other_status == 1){
			var soft_li = '<li ><p class="soft_icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft_name">'+softname+'</p><p class="btn"><a id="'+softid+'" href="javascript:;" class="soft_btn install" >已下载</a></p></li>';
		}
	}
	return soft_li;
}
$(document).ready(function () {
	if(typeof(window.AnzhiActivitys)!='undefined'){
		setTimeout(function(){
			my_soft();
		}, 500);
	}
	$("body").bind('touchmove', function (e) {
		if(!flags.canMove){
			e.preventDefault();
		}
	});
});

function change_soft(){
	$('#soft-list').html('');
	get_soft();
}


function openApp(pkg,softid){
	<!--{if $out['is_login'] == 2}-->
		login('<!--{$out.login_url}-->','<!--{$out.version_code}-->');
		return false;
	<!--{/if}-->
	the_soft = [softid];
	$.ajax({
		url: '/lottery/vacation_gift_open.php',
		data: 'softid='+softid+'&sid='+sid+'&package='+pkg+'&aid='+aid,
		type: 'get',
		success: function(data){
			window.AnzhiActivitys.openAppForActivity(pkg,the_soft);
		}
	});
}


function go_softinfo_down(softid,my_package,softname,versioncode,size){
	$('#li_'+softid+'').removeAttr("onclick");
	$('#'+softid+'').html("下载中").removeAttr("onclick").attr("class","soft_btn down_ing");
	$.ajax({
		url: '/lottery/year_feedback_download.php',  //supwater  点击详情 点击下载
		data:"softid="+softid+"&sid="+sid+"&aid="+aid+"&pkgname="+my_package, 
		type:"post",
		success:function(data) {
			window.AnzhiActivitys.downloadForActivity(parseInt(aid),softid,my_package,softname,versioncode,size,0);
		},
	});
}

function onDownloadStateChanged(softid,newState){
	if(newState == 1){
		$('#'+softid+'').html("下载中").attr("class","soft_btn down_ing");
	}else if(newState == 2 || newState == 3 || newState == 8){
		$('#'+softid+'').html("继续").attr("class","soft_btn down");
		for(i=0;i < soft_lists_go.length;i++){
			if(soft_lists_go[i][0] == softid){
				if(soft_lists_go[i][2].length > 4){
					var softname = soft_lists_go[i][2].substring(0,3)+'...';
				}else{
					var softname = soft_lists_go[i][2];
				}				
				$('#li_'+softid+'').attr('onclick',"go_softinfo_down("+parseInt(softid)+",'"+soft_lists_go[i][7]+"','"+softname+"','"+soft_lists_go[i][13]+"','"+soft_lists_go[i][soft_lists_go[i].length-1]+"')");
			}
		}				
	}else if(newState == 4){
		$('#'+softid+'').html("重试").attr("class","soft_btn down");
	}else if(newState == 5){		
		$('#'+softid+'').html("安装").attr("class","soft_btn install");
		$('#li_'+softid+'').removeAttr("onclick");
		for(i=0;i < soft_lists_go.length;i++){
			if(soft_lists_go[i][0] == softid){
				$('#li_'+softid+'').attr('onclick',"installApp("+parseInt(softid)+",'"+soft_lists_go[i][7]+"')");
			}
		}
	}else if(newState == 6){
		$('#'+softid).html("打开").attr("class","soft_btn open");
		$('#li_'+softid+'').removeAttr("onclick");
		for(var i=0;i < soft_lists_go.length;i++){		
			if(soft_lists_go[i][0] == softid){
				$('#li_'+softid).attr('onclick',"openApp('"+soft_lists_go[i][7]+"',"+parseInt(softid)+")").attr("class","soft_btn open");
                break;
			}
		}
	}else if(newState == 9){
		$('#'+softid+'').html("检查中").attr("class","soft_btn down");			
	}
}

function installApp(softid,pkgname){
	$.ajax({
		url: '/lottery/vacation_third_install.php',
		data: 'softid='+softid+'&sid='+sid+'&package='+pkgname+'&aid='+aid,
		type: 'post',
		success: function(data){
			window.AnzhiActivitys.installAppForActivity(softid);
		}
	});
}


//分享
function go_share(){
	$.ajax({
		url: '/lottery/my_name_MT3_new/share.php',
		data: 'sid='+sid+'&aid='+aid,
		type: 'get',
		async:false,
		success:function(data){
		}
	});
	var share_text="<!--{$out.list.share_text}-->";	
	var share_url='<!--{$out.activity_host}-->/lottery/vip/vip_discount.php?type='+type+'&is_share=1&aid='+aid;	
	var icon_url = 	"<!--{$out.img_url}--><!--{$out.list.share_other_pic}-->";
	var weixin_icon_url = 	"<!--{$out.img_url}--><!--{$out.list.share_weixin_pic}-->";
	var share_json = '{"TEXT":"'+share_text+'","URL":"'+icon_url+'","ACTIONURL":"'+share_url+'","URLWEIXIN":"'+weixin_icon_url+'"}';
	window.AnzhiActivitys.getShareDialog(share_json);
}


<!--{if $out['is_share'] == 1}-->
document.write(unescape("%3Cscript src='/js/anzhi-fd-min1.js?v"+Math.round(Math.random()*100)+"' type='text/javascript'%3E%3C/script%3E"));
var js_param = {type:'action', id:aid, callback:invite_callback};
var php_param = {type:'action', aid:aid};
$(document).ready(function () {
	Azfd.share_download(js_param, php_param);
});	
function invite_callback() {
	if (typeof(arguments[0]) != 'undefined') {
		var magic = arguments[0];
		var version = parseInt(arguments[1]);
		var firmware = arguments[2];
		var flag = arguments[3];
		if(version >= 6200){
			js_param = {type:'action', id:aid, callback:null};
			Azfd.lock = false;
			share_download(js_param, php_param);			
		}else {
			setTimeout(function(){
				var php_url = 'fast.php?';
				for (var i in php_param) {
					php_url += '&' + i + '=' + php_param[i];
				}
				window.location.href=php_url;			
			},1000);		
		} 
	}else{
		setTimeout(function(){
			var php_url = 'fast.php?';
			for (var i in php_param) {
				php_url += '&' + i + '=' + php_param[i];
			}
			window.location.href=php_url;			
		},1000);		
	}
}
function is_null(){}
<!--{/if}-->	
function go_vip_detail(){
	var url = "vip_discount.php?aid="+aid+"&click=2&sid="+sid+"&type="+type;
	window.location.href=url;	
}

var is_sdk = '<!--{$out.is_sdk}-->';
function go_vip(){
	$.ajax({
		url: 'vip_discount.php',
		data: 'sid='+sid+'&aid='+aid+'&click=1',
		type: 'get',
		async:false,
		success:function(data){
			if(is_sdk == 1){
				var json = '{"pageName":"PAY_MEMBER"}';
				window.AnzhiActivitys.sdkComMed(json,1);
			}else{
				showOpenBox('#tip-box1');
			}
		}
	});
}

var flags={canMove:true};
function showOpenBox(obj){
	 var bg_h=$(window).height() + $(document).scrollTop(),
			top_h= $(obj).height()/ 2 - $(document).scrollTop();
	$(obj).css("margin-top",-top_h+"px").show();
	$("#body-bg").css("height",bg_h+"px").show();
	flags.canMove=false;
	window.onresize = function(){
		var bg_h=$(window).height() + $(document).scrollTop(),
			top_h= $(obj).height()/ 2 - $(document).scrollTop();
		$('#body-bg').css("height",bg_h+"px");
		$(obj).css("margin-top",-top_h+"px");
		
	}
}
function cloBox(obj){
	$(obj).hide();
	$("#body-bg").hide();
	flags.canMove=true;
}
$(function(){
	$("body").bind('touchmove', function (e) {
		if(!flags.canMove){
			e.preventDefault();
		}
	});
})
</script>