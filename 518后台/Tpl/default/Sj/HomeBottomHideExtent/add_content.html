<link type="text/css" rel="stylesheet" href="/Public/css/public.css" />
<link type="text/css" rel="stylesheet" href="/Public/css/recommend.css" />
<link rel="stylesheet" type="text/css" media="all" href="/Public/js/calendar-win2k-cold-1.css" title="win2k-cold-1" />
<script type="text/javascript" src="/Public/js/calendar_bak.js"></script>
<script type="text/javascript" src="/Public/js/calendar-zh.js"></script>
<script type="text/javascript" src="/Public/js/calendar-setup.js"></script>

<script type="text/javascript" src="/Public/js/jquery.autocomplete-min.js"></script>
<link href="/Public/css/autocomplete.css" rel="stylesheet" type="text/css" />

<style>
.sub_tr {
height: 35px;
text-align: left;
}
</style>

<script>
    jQuery(function(){
        options = {
            serviceUrl:'/index.php/Public/showActivity',
            minChars:1,
            width: '300px',
            deferRequestBy: 0,
            onSelect: function(value, data){
            }
        };
        $('#activity_name').autocomplete(options);
        
        options = {
            serviceUrl:'/index.php/Public/showFeature',
            minChars:1,
            width: '300px',
            deferRequestBy: 0,
            onSelect: function(value, data){
            }
        };
        $('#feature_name').autocomplete(options);
        
        options = {
            serviceUrl:'/index.php/Public/showCategoryPage',
            minChars:1,
            width: '300px',
            deferRequestBy: 0,
            onSelect: function(value, data){
            }
        };
        $('#page_name1').autocomplete(options);
        
        // 标签类型
        options = {
            serviceUrl:'/index.php/Public/showTagPage',
            minChars:1,
            width: '300px',
            deferRequestBy: 0,
            onSelect: function(value, data){
            }
        };
        $('#page_name2').autocomplete(options);
        
        // 常用标签
        options = {
            serviceUrl:'/index.php/Public/showCommonTagPage',
            minChars:1,
            width: '300px',
            deferRequestBy: 0,
            onSelect: function(value, data){
            }
        };
        $('#page_name3').autocomplete(options);
        
        // 其他页面
        options = {
            serviceUrl:'/index.php/Public/showOtherFixedPage',
            minChars:1,
            width: '300px',
            deferRequestBy: 0,
            onSelect: function(value, data){
            }
        };
        $('#page_name4').autocomplete(options);
    });
    
    function content_type_select(val) {
        if (val == 1) {
            document.getElementById("tr_package").style.display="";
            document.getElementById("tr_activity").style.display="none";
            document.getElementById("tr_feature").style.display="none";
            document.getElementById("tr_page").style.display="none";
            document.getElementById("tr_website").style.display="none";
            
            document.getElementById("tr_editor_recommendation").style.display="";
            document.getElementById("tr_image").style.display="none";
        } else if (val == 2) {
            document.getElementById("tr_package").style.display="none";
            document.getElementById("tr_activity").style.display="";
            document.getElementById("tr_feature").style.display="none";
            document.getElementById("tr_page").style.display="none";
            document.getElementById("tr_website").style.display="none";
            
            document.getElementById("tr_editor_recommendation").style.display="none";
            document.getElementById("tr_image").style.display="";
        } else if (val == 3) {
            document.getElementById("tr_package").style.display="none";
            document.getElementById("tr_activity").style.display="none";
            document.getElementById("tr_feature").style.display="";
            document.getElementById("tr_page").style.display="none";
            document.getElementById("tr_website").style.display="none";
            
            document.getElementById("tr_editor_recommendation").style.display="none";
            document.getElementById("tr_image").style.display="";
        } else if (val == 4) {
            document.getElementById("tr_package").style.display="none";
            document.getElementById("tr_activity").style.display="none";
            document.getElementById("tr_feature").style.display="none";
            document.getElementById("tr_page").style.display="";
            document.getElementById("tr_website").style.display="none";
            
            document.getElementById("tr_editor_recommendation").style.display="none";
            document.getElementById("tr_image").style.display="";
        } else if (val == 5) {
            document.getElementById("tr_package").style.display="none";
            document.getElementById("tr_activity").style.display="none";
            document.getElementById("tr_feature").style.display="none";
            document.getElementById("tr_page").style.display="none";
            document.getElementById("tr_website").style.display="";
            
            document.getElementById("tr_editor_recommendation").style.display="none";
            document.getElementById("tr_image").style.display="";
        }
    }
    
    function general_page_type_select(val) {
        if (val == 1) {
            document.getElementById("page_name1").style.display="";
            document.getElementById("page_name2").style.display="none";
            document.getElementById("page_name3").style.display="none";
            document.getElementById("page_name4").style.display="none";
        } else if (val == 2) {
            document.getElementById("page_name1").style.display="none";
            document.getElementById("page_name2").style.display="";
            document.getElementById("page_name3").style.display="none";
            document.getElementById("page_name4").style.display="none";
        } else if (val == 3) {
            document.getElementById("page_name1").style.display="none";
            document.getElementById("page_name2").style.display="none";
            document.getElementById("page_name3").style.display="";
            document.getElementById("page_name4").style.display="none";
        } else {
            document.getElementById("page_name1").style.display="none";
            document.getElementById("page_name2").style.display="none";
            document.getElementById("page_name3").style.display="none";
            document.getElementById("page_name4").style.display="";
        }
    }
    
    //主层动态变化数据
    function onclikChannel() {	
        $('#channel_div').html('');
        $(".TB_ajaxContent #channel_selected input:checked").each(function(){
            var item = $('<label class="l_cid_'+this.value+'">' + $('#channel_selected .l_cid_' + this.value).html() + '</label>');
            item.find('input').attr('checked', 'true');
            item.find('input').unbind("click");
            item.find('input').attr("onclick", '');
            $('#channel_div').append(item);
        })
        $.cookie('cids', '', {path: '/'});
    }

    function check_arr() {
        $('.TB_ajaxContent #channel_selected').html($('#channel_div').html());
    }
    
    function no_select(value_select) {
        if(value_select == 1) {
            document.getElementById('old_phone').disabled = true;
            $('#old_phone').attr('checked',false);
        } else if(value_select == 2 || value_select == 3){
            document.getElementById('old_phone').disabled = false;
        }
    }
    
    function checkLen(obj, maxChars, hint_id) {
        if (obj.value.length > maxChars)
            obj.value = obj.value.substring(0,maxChars);
        $("#" + hint_id).html(obj.value.length + "/" + maxChars);
    };
    
    function checkPost() {
        var content_type = $("#add_content_form #content_type").val();
        if (content_type == 1) {
            var package = $("#add_content_form #package").val();
            if (!package) {
                alert("包名不能为空！");
                return false;
            }
        } else if (content_type == 2) {
            var activity_name = $("#add_content_form #activity_name").val();
            if (!activity_name) {
                alert("活动名称不能为空！");
                return false;
            }
        } else if (content_type == 3) {
            var feature_name = $("#add_content_form #feature_name").val();
            if (!feature_name) {
                alert("专题名称不能为空！");
                return false;
            }
        } else if (content_type == 4) {
            var general_page_type = $("#add_content_form #general_page_type").val();
            var page_name = $("#add_content_form #page_name" + general_page_type).val();
            if (!page_name) {
                alert("页面不能为空！");
                return false;
            }
        } else if (content_type == 5) {
            var website = $("#add_content_form #website").val();
            if (!website) {
                alert("网页不能为空！");
                return false;
            }
        }
        
        if (content_type == 1) {
            var editor_recommendation = $("#add_content_form #editor_recommendation").val();
            if (!editor_recommendation) {
                alert("小编推荐不能为空！");
                return false;
            }
        } else {
            var image_url = $("#add_content_form #image_url").val();
            if (!image_url) {
                alert("图片不能为空！");
                return false;
            }
        }
        
        var start_at = $("#add_content_form #start_at").val();
        if (!start_at) {
            alert("开始时间不能为空！");
            return false;
        }
        var end_at = $("#add_content_form #end_at").val();
        if (!end_at) {
            alert("结束时间不能为空！");
            return false;
        }
        if (start_at > end_at) {
            alert("开始时间不能大于结束时间！");
            return false;
        }
    }
</script>

<form id="add_content_form" method="POST" action="__URL__/add_content" enctype="multipart/form-data" onsubmit="return checkPost()">
<table class="sub_tab" align="center" cellspacing="0" cellpadding="0" border="0">
    <tr class="sub_tr">
        <td><font color="red">*</font>类型</td>
        <td>
            <select name='content_type' id="content_type" onchange="content_type_select(this.value);">
                <option value="1">软件</option>
                <option value="2">活动</option>
                <option value="3">专题</option>
                <option value="4">页面</option>
                <option value="5">网页</option>
            </select>
        </td>
        <td/>
    </tr>
    <tr class="sub_tr" name="tr_package" id="tr_package">
        <td><font color="red">*</font>包名</td>
        <td>
            <input type="text" name="package" id="package"/>
        </td>
        <td/>
    </tr>
    <tr class="sub_tr" name="tr_activity" id="tr_activity" style="display:none">
        <td><font color="red">*</font>活动</td>
        <td>
            <input type="text" name="activity_name" id="activity_name"/>
        </td>
        <td/>
    </tr>
    <tr class="sub_tr" name="tr_feature" id="tr_feature" style="display:none">
        <td><font color="red">*</font>专题</td>
        <td>
            <input type="text" name="feature_name" id="feature_name"/>
        </td>
        <td/>
    </tr>
    <tr class="sub_tr" name="tr_page" id="tr_page" style="display:none">
        <td><font color="red">*</font>页面</td>
        <td>
            <select name='general_page_type' id="general_page_type" onchange="general_page_type_select(this.value);">
                <option value="1">普通</option>
                <option value="2">标签</option>
                <option value="3">常用标签</option>
                <option value="4">其他</option>
            </select>
        </td>
        <td>
            <input type="text" name="page_name1" id="page_name1"/>
            <input type="text" name="page_name2" id="page_name2" style="display:none"/>
            <input type="text" name="page_name3" id="page_name3" style="display:none"/>
            <input type="text" name="page_name4" id="page_name4" style="display:none"/>
        </td>
        <td/>
    </tr>
    <tr class="sub_tr" name="tr_website" id="tr_website" style="display:none">
        <td><font color="red">*</font>网页</td>
        <td>
            <input type="text" name="website" id="website"/>
        </td>
        <td/>
    </tr>
    <tr class="sub_tr" name="tr_editor_recommendation" id="tr_editor_recommendation">
        <td><font color="red">*</font>小编推荐</td>
        <td>
            <textarea name="editor_recommendation" id="editor_recommendation" onBlur="checkLen(this, 100, 'editor_recommendation_hint')" onKeyUp="checkLen(this, 100, 'editor_recommendation_hint')"></textarea>
        </td>
        <td><span id="editor_recommendation_hint">0/100</span></td>
    </tr>
    <tr class="sub_tr" name="tr_image" id="tr_image" style="display:none">
        <td><font color="red">*</font>图片</td>
        <td><input name='image_url' id="image_url" type='file'/></td>
        <td>限制上传{$image_width}*{$image_height}的JPG/PNG图片</td>
    </tr>
    <!--
    <tr class="sub_tr" id="tr_phone_dis">
        <td>高低配区分展示</td>
        <td><input type="radio" name="phone_dis" value="1" id="no_dis" onclick="no_select(1);" checked  />不做区分<br /><input type="radio" name="phone_dis" value="2" onclick="no_select(2);" />仅高配手机展示<br /><input type="radio" name="phone_dis" value="3" onclick="no_select(3);" />仅低配手机展示<br /><input type="checkbox" name="old_phone" id="old_phone" value="1" disabled="disabled" />显示在旧版本中(低于V4.4.1)
        </td>
        <td/>
    </tr>
    -->
    <tr class="sub_tr">
		<td>运营商</td>
		<td>
			<SELECT name='oid'>
				<option value='0'>不限制</option>
				<?php foreach($operatinglist as $val): ?>
					<option value='<?php echo $val['oid']?>'><?php echo $val['mname']?></option>
				<?php endforeach; ?>				
			</SELECT>
		</td>
        <td></td>
	</tr>
	<tr class="sub_tr">
		<td>渠道</td>
		<td>
		<a href="__APP__/Public/showChannel?callback=submitChannel&type=radio&ready=check_arr&selected=onclikChannel" class="thickbox"><font color="blue">选择指定渠道</font></a><br />
		<div id="channel_div">
		</div>
		</td>
        <td></td>
	</tr>
    <tr class="sub_tr">
		<td><font color="red">*</font>开始时间</td>
		<td>
            <input id="start_at" name="start_at" type="text" class="Wdate" style="float:left" onClick="WdatePicker({startDate:'%y-%M-%d %h:%i:%s', dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>
        </td>
        <td/>
	</tr>
	<tr class="sub_tr">
		<td><font color="red">*</font>结束时间</td>
		<td>
            <input id="end_at" name="end_at" type="text" class="Wdate" style="float:left" onClick="WdatePicker({startDate:'%y-%M-%d %h:%i:%s', dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>
        </td>
        <td/>
	</tr>
	<tr class="sub_tr">
		<td colspan="3">
            <input type='hidden' name="extent_id" value='<?php echo $extent_id?>'/>
            <input type='submit' value="&nbsp;&nbsp;确定&nbsp;&nbsp;"/><input type="button" onclick="tb_remove()" value="&nbsp;&nbsp;取消&nbsp;&nbsp;">
        </td>
	</tr>
</table>
</form>