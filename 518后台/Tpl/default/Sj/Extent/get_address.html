var address=<?php echo $json;?>;function GoAddress(){	this.name = 'location';	this.top_name = 'province';	this.sub_name = 'city';	this.top_to = 'top_area';	this.disabled = false;	this.multi = true;	this.list = {};	this.index = 0;	this.tpl = '<div><select name=""></select>-<select></select><input type="button" value="添加"><span style="color:red"></span></div>';	this.index = 0;	this.obj_prefix = 'go_area_';	this.value = '';}GoAddress.prototype = {	getAreaOption: function(c) {		var html = '<option value="" rel="">所有</option>';		var checked = '';		if (typeof(arguments[1]) != 'undefined') {			checked = arguments[1];		}		for(var i in address[c]){			if (checked == address[c][i][0]) {				html += "<option rel='" + i + "' value='" + address[c][i][0] + "' selected='true'>" + address[c][i][0] + "</option>";			} else {				html += "<option rel='" + i + "' value='" + address[c][i][0] + "'>" + address[c][i][0] + "</option>";			}		}		return html;	},	addTopArea: function () {				var _this = this;		var _div = $(this.tpl);		var index = this.index;		if (this.multi == true) {			this.index++;		}		$(_div).attr('id', this.obj_prefix + index);		$(_div).attr('rel', index);		var html = '';		if (typeof(arguments[0]) != 'undefined') {			var checked = arguments[0];			html = this.getAreaOption(1, checked);		} else {			html = this.getAreaOption(1);		}		if (this.multi == false) {			$(_div).find('select:first').attr('name', this.top_name);		} else {			$(_div).find('select:first').attr('name', this.top_name + index);		}		$(_div).find('select:first').attr('rel', index);		$(_div).find('select:first').html(html);				if (this.disabled) {			$(_div).find('select:first').attr('disabled', true);			$(_div).find('input').attr('disabled', true);		} else {			$(_div).find('select:first').change(function(){				_this.showSubArea(index);				_this.refreshValue();			});					}		if (this.multi == false) {			$(_div).find('input').remove();			$('#' + this.top_to).html(_div);		} else {			//处理 添加/删除 按钮.			if (index == 0){				//第一个是添加				$(_div).find('input').click(function(){					_this.addTopArea();					_this.refreshValue(index);				});			} else {				//第一个以外都是删除				$(_div).find('input').attr('value', '删除');				$(_div).find('input').click(function(){					_this.delArea(index);					_this.refreshValue(index);				});			}			$('#' + this.top_to).append(_div);		}		if (index == 0) {			$('#' + this.top_to).append('<input type="hidden" name="' + this.name + '">');		}				if (typeof(arguments[1]) != 'undefined') {			_this.showSubArea(index, arguments[1]);		}else {			_this.showSubArea(index);		}		this.refreshValue();	},		showSubArea: function (index) {		var _this = this;		var html = '';		var sub_c = $('#' + this.obj_prefix + index).find('select:first').children('option:selected').attr('rel');		if (typeof(arguments[1]) != 'undefined') {			var checked = arguments[1];			html = this.getAreaOption(sub_c, checked);		} else {			html = this.getAreaOption(sub_c);		}		if (this.multi == false) {			$('#' + this.obj_prefix + index).find('select:last').attr('name', this.sub_name);		} else {			$('#' + this.obj_prefix + index).find('select:last').attr('name', this.sub_name  + index);		}		$('#' + this.obj_prefix + index).find('select:last').attr('rel', index);		$('#' + this.obj_prefix + index).find('select:last').html(html);		if (this.disabled) {			$('#' + this.obj_prefix + index).find('select:last').attr('disabled', true);		}				$('#' + this.obj_prefix + index).find('select:last').change(function(){			_this.refreshValue(index);		});	},		delArea: function (index) {		$('#' + this.obj_prefix + index).remove();	},		refreshValue: function() {		this.checkValue();		var location = '';		$('#' + this.top_to + ' [id^=' + this.obj_prefix + ']').each(function(){			var p = $(this).find('select:first').val();			var c = $(this).find('select:last').val();			if (p != '') {				var tmp = p + ',' + c;				if (location != '') {					location += ';' + tmp;				} else {					location += tmp;				}			}		});		$('#' + this.top_to + ' input[name=' + this.name + ']').val(location);	},		checkValue: function() {		var check_arr = {};		var all_province = false;		var has_province = false;		var i = 0;		var error = [];		var _this = this;		$('#' + this.top_to + ' [id^=' + this.obj_prefix + ']').each(function(){			var index = $(this).attr('rel');			var p = $(this).find('select:first option:selected').attr('rel');			var c = $(this).find('select:last option:selected').attr('rel');						if (p == '') all_province = true;			if (p != '') has_province = true;						var tmp_error = {};			var has_error = false;			if (all_province === has_province) {				tmp_error = {'index': index, 'type': 1};				error.push(tmp_error);				has_error = true;			}									if (p != '' && typeof(check_arr[p]) != 'undefined' && (check_arr[p] == '' || c == '' || check_arr[p] == c)) {				tmp_error = {'index': index, 'type': 2};				error.push(tmp_error);				has_error = true;			}			i++;			check_arr[p] = c;			if (has_error) {				$('#' + _this.obj_prefix + index + ' span'). html('区域设置错误，可能存在重复区域设置');			} else {				$('#' + _this.obj_prefix + index + ' span'). html('');			}		});				return error.length==0;	}};