<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta content="telephone=no" name="format-detection">
<meta name="keywords" content="" />
<meta name="description" content="" />
<title>11.11给你一个脱单的机会</title>
<link type="text/css" rel="stylesheet" href="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/css/common.css?v1"/>
<script type="text/javascript"  src="http://img4.anzhi.com/static/public/js/jquery-1.8.0.min.js"></script>
<script type="text/javascript">
    (function (doc, win) {
    	var docEl = doc.documentElement,
        resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
        recalc = function () {
            var clientWidth = docEl.clientWidth;
            if (!clientWidth) return;
            if(clientWidth>=640){
				docEl.style.fontSize = '100px';
			}else{
				docEl.style.fontSize = 100 * (clientWidth / 640) + 'px';
			}
        };
	    // Abort if browser does not support addEventListener
	    if (!doc.addEventListener) return;
	    win.addEventListener(resizeEvt, recalc, false);
	    doc.addEventListener('DOMContentLoaded', recalc, false);
	   //以640像素设计图为准 ，1rem代表100像素
	})(document, window);
</script>
</head>
<body>
<div class="main">
	<div class="main_inner">
		<div class="process_wrap">
			<div class="process"></div>
		</div>
		<div class="wrap mousehit">
			<ul>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
				<li>
					<span></span>
					<em></em>
					<i>+1</i>
					<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png"/>
				</li>
			</ul>
		</div>
	</div>
</div>
<div class="mask"></div>
<section>
    <div id="body-bg" style="display: none;"></div>
    <div class="tip-box wrap" id="tip-box4"  style="height:280px; display: none;">
    	<span class="icon"></span>
		<div class="tip-mid">
            <div class="tip-con">
            	<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/tips_04.png" style="margin:0 auto 10px;" />
                <p>脱单失败！<br/>少年该练练手速啦！</p>
            </div>
        </div>
        <div class="tip_hd">
            <div class="clo"></div>
        </div>
		<a href="javascript:;"   onclick="play_again('#tip-box4')" class="btns_orange">再来一次</a>
    </div>
    <div class="tip-box wrap" id="tip-box6"  style="height:280px; display: none;">
    	<span class="icon"></span>
		<div class="tip-mid">
            <div class="tip-con">
            	<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/mouse.png" style="margin:0 auto 10px;" />
                <p>脱单成功！<br/>请收下安智君的膝盖！<span>点击分享才可以抽奖哦！</span></p>
            </div>
        </div>
        <div class="tip_hd">
            <div class="clo"></div>
        </div>
		<div class="btns2">
			<a href="javascript:;"   onclick="play_again('#tip-box6')"   class="fl">再玩一次</a>
			<a href="javascript:;"  onclick="go_share();" class="fr">分享去抽奖</a>
			<div class="clear"></div>
		</div>
    </div>	
    <div class="tip-box wrap" id="tip-box5"  style="height:280px; display: none;">
    	<span class="icon"></span>
		<div class="tip-mid">
            <div class="tip-con">
            	<img src="<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/tips_03.png" style="margin:0 auto 10px;" />
                <p>少年,今天的机会用完啦！<br/>明天继续来脱单！<br/><span>偷偷告诉你，下载APP增加抽奖机会呦~</span></p>
            </div>
        </div>
        <div class="tip_hd">
            <div class="clo"></div>
        </div>
		<div class="btns2">
			<a  class="fl" href="/lottery/<!--{$out.prefix}-->/lottery.php?aid=<!--{$out.aid}-->&sid=<!--{$out.sid}-->" >去下载</a>
			<a  class="fr" href="/lottery/<!--{$out.prefix}-->/index.php?aid=<!--{$out.aid}-->&sid=<!--{$out.sid}-->" >返回首页</a>
			<div class="clear"></div>
		</div>
    </div>		
</section>

<script type="text/javascript">
var sid = '<!--{$out.sid}-->';
var aid = '<!--{$out.aid}-->';
var prefix = '<!--{$out.prefix}-->';
var gm_num = '<!--{$out.gm_num}-->';
//==============================================================================

//游戏开始
function GameStart(){
	if(gm_num >= 3){
		showOpenBox('#tip-box5');
		return false;
	}	
	$.ajax({
		url: '/lottery/'+prefix+'/page_index.php',
		data: 'sid='+sid+'&aid='+aid+'&num=1',
		type: 'post',
		success: function(ret){
			if(ret > 3){
				showOpenBox('#tip-box5');
				return false;
			}
			gm_num = parseInt(gm_num+1);
		}
	});		
	$('.mask').css('display','block')
	var iCount = 3;
	var str = "<img src='<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/start-"+iCount+".png'/>";
	$('.mask').html(str);
	var showDown = null;
	showDown = setInterval(function(){
		if(iCount>=1){
			iCount--;
			if(iCount>=1){
				str = "<img src='<!--{$out.new_static_url}-->/activity/<!--{$out.prefix}-->/images/start-"+iCount+".png'/>";
				$('.mask').html(str);
				console.log(iCount)
			}
			if(iCount==0){
				$('.mask').hide();
				var countDown = null;
				var count = 20;
				var widthLength = 3.7;
				countDown = setInterval(function(){
					count--;
					widthLength-=0.185;
					$('.process').css('width',widthLength+'rem');
					play();				
					if(count<=0){
						clearInterval(countDown);
						if(score < 10){
							showOpenBox('#tip-box4');
						}else{
							showOpenBox('#tip-box6');
						}
						setTimeout(function(){
							$('.process').css('width','3.7rem');
						},2000)
					}
				},1000)
			}
		}
	},1000)
	var score = 0;
	$('.mousehit ul li img').bind('click',function(){
		score++;
		$_this = $(this);
		$(this).siblings('em').show();
		$(this).siblings('i').show();
		//$(this).addClass('mouseDown').removeClass('mouseUp'); 
		setTimeout(function(){
			$_this.siblings('em').hide();
			$_this.siblings('i').hide();
			$_this.addClass('mouseDown').removeClass('mouseUp'); 
		},100)
	})	
}		

function mouseShow(){
	// 获取一个0~8的随机数  
	var a = Math.random() * 9;
	// 将获取的数 去掉小数位  
	a = Math.floor(a);
	$('.mousehit ul li img').eq(a).addClass('mouseUp').removeClass('mouseDown');
	setTimeout(function(){  
		$('.mousehit ul li img').eq(a).addClass('mouseDown').removeClass('mouseUp');   
	} , 2000);
}
function play(){
	setTimeout(mouseShow,300);
	setTimeout(mouseShow,600);			
}


//=================================================================== 

//分享

function go_share(){
	$.ajax({
		url: '/lottery/my_name_MT3_new/share.php',
		data: 'sid='+sid+'&aid='+aid,
		type: 'get',
		async:false,
		success:function(data){
		}
	});
	setTimeout(function(){
		$.ajax({
			url:'/lottery/'+prefix+'/lottery.php',
			data:"is_share_num=1&aid="+aid+"&sid="+sid,
			type:'get',
			success:function(res){
				window.location.href='/lottery/'+prefix+'/lottery.php?aid='+aid+'&sid='+sid;			
			}
		});		
	},3000);		
	var share_text="今年双十一，我在安智市场成功脱单啦，你来快也试试吧！还有大奖可以拿！";	
	var share_url='<!--{$out.activity_host}-->/lottery/'+prefix+'/index.php?is_share=1&aid='+aid;	
	var share_json = '{"TEXT":"'+share_text+'","URL":"http://img4.anzhi.com/static/activity/'+prefix+'/images/share_icon.jpg","ACTIONURL":"'+share_url+'","URLWEIXIN":"http://img4.anzhi.com/static/activity/'+prefix+'/images/share_icon.jpg"}';

	window.AnzhiActivitys.getShareDialog(share_json);
}
// 客户端分享回调函数
function onSharedResult(share_result) {
        var result_json = $.parseJSON(share_result);
        //分享应用类型（0：短信，1：新浪微博，2：QQ空间，3：微信好友，4：微信朋友圈，6：QQ好友）
        var appType = result_json.appType; 
         //分享结果（1：分享成功，2：分享取消，3：分享失败）
        var resultType = result_json.resultType;
        // 记日志
        $.ajax({
			url:'/lottery/coactivity_share_result.php',
			data:"aid="+aid+"&sid="+sid+"&appType="+appType+"&resultType="+resultType,
			type:'post',
			success:function(){
			}
        });
}
<!--{if $out['is_share'] == 1}-->
document.write(unescape("%3Cscript src='/js/anzhi-fd-min1.js?v"+Math.round(Math.random()*100)+"' type='text/javascript'%3E%3C/script%3E"));
var js_param = {type:'action', id:aid, callback:invite_callback};
var php_param = {type:'action', aid:aid};
$(document).ready(function () {
	Azfd.share_download(js_param, php_param);
});	
function invite_callback() {
	if (typeof(arguments[0]) != 'undefined') {
		var magic = arguments[0];
		var version = parseInt(arguments[1]);
		var firmware = arguments[2];
		var flag = arguments[3];
		if(version >= 6200){
			js_param = {type:'action', id:aid, callback:null};
			Azfd.lock = false;
			share_download(js_param, php_param);			
		}else {
			setTimeout(function(){
				var php_url = 'fast.php?';
				for (var i in php_param) {
					php_url += '&' + i + '=' + php_param[i];
				}
				window.location.href=php_url;			
			},1000);		
		} 
	}else{
		setTimeout(function(){
			var php_url = 'fast.php?';
			for (var i in php_param) {
				php_url += '&' + i + '=' + php_param[i];
			}
			window.location.href=php_url;			
		},1000);		
	}
}
function is_null(){}
<!--{/if}-->	

$(document).ready(function () {
	GameStart();
});  

var flags={canMove:true};
function showOpenBox(obj){
	setTimeout(function(){
		var bg_h=$(window).height() + $(document).scrollTop(),
		top_h=  $(obj).height()/2 - $(document).scrollTop();
		$(obj).css("margin-top",-top_h+"px").show();
		$('#body-bg').css("height",bg_h+"px").show();
		flags.canMove=false;
		if($('.tip-con').height()>=150){
			flags.canMove = true;
		}
		window.onresize = function(){
			var bg_h=$(window).height() + $(document).scrollTop(),
				top_h=  $(obj).height()/2 - $(document).scrollTop();
			$('#body-bg').css("height",bg_h+"px");
			$(obj).css("margin-top",-top_h+"px");	
		}
	},200)
}
function cloBox(obj){
	$(obj).hide(); 
	$('#body-bg').hide();
	flags.canMove=true;
}
$(function(){
	$("body").bind('touchmove', function (e) {
		if(!flags.canMove){
			e.preventDefault();
		}
	});
})

//
function play_again(obj){
	cloBox(obj);
	GameStart();
}	
</script>
</body>
</html>