<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta content="telephone=no" name="format-detection">
<meta name="keywords" content="" />
<meta name="description" content="" />
<title>充值送积分,豪礼兑回家！</title>
<link type="text/css" rel="stylesheet" href="<!--{$out.static_url}-->/integral/css/common_v1.css"/>
<script type="text/javascript" src="http://img3.anzhi.com/static/public/js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="http://img3.anzhi.com/static/public/js/TouchSlide.1.1.js"></script>
<style type="text/css">
.btns_tip{background:#ff6263;}
</style>
</head>
<body>
<div class="banner">
    <img src="<!--{$out.static_url}-->/integral/images/banner.jpg"/>
</div>
<div class="main">
	<div class="main_iner">
		<div class="title "></div>
		<div class="mod pad10">
			<h6>活动时间</h6>
			<p>7月29日00：00-31日22：00</p>
			<h6 class="padtop10">活动说明</h6>
			<p>缤纷假日，充值送积分，豪礼兑回家！<br/>活动期间凡在用户中心中充值，即可获得等值的积分；积分可用于兑换不同的奖品，每用户每天可兑换的次数
	上限为5次，奖品数量有限，活动期间兑完为止！</p>
			<p class="padtop10">*Tips：如果活动时间截止前，奖品已被抢购一空，活动则即刻结束；</p>
		</div>
	<!--{if $out['is_login'] == 2}-->
		<div class="points_login">
			<a href="<!--{$out.login_url}-->"></a>
			<p>登陆可查看个人可用积分哦！<br/>充值新增的积分15分钟刷新一次哦！</p>
		</div>
	<!--{/if}-->
	<!--{if $out['is_login'] == 1}-->
		<div class="login_user">
			<a href="/lottery/integral_userinfo.php?types=3" ></a>
			<p>
				用户名：<!--{$out.username}--> <br/>
				<!--{if $out.rest_integral != null}-->
					可用积分：<!--{$out.rest_integral}--><br/>
				<!--{else}-->
					可用积分：0<br/>
				<!--{/if}-->
				充值新增的积分15分钟刷新一次哦！
			</p>
		</div>
	<!--{/if}-->		
		<div class="mod pad10">
			<div class="mod_bg"></div>
			<ul class="points_list">
			<!--{foreach from=$out.num_arr item='val' key='k'}-->
				<!--{assign var='num' value="prize_list_$val"}-->
				<!--{if $out.$num.num <= 0}-->
				<li>
					<img src="<!--{$out.static_url}-->/integral/images/points_<!--{$out.$num.id}-->.jpg"/>
					<div class="points_txt">
						<p><!--{$out.$num.name}--></p>
						<p>剩余数量：<span><!--{$out.$num.num}--></span></p>
					</div>
					<em></em>
				</li>					
				<!--{else}-->
				<li onclick="exchange_prize(1,'<!--{$out.$num.id}-->','<!--{$out.$num.prize_integral}-->','<!--{$out.$num.name}-->',<!--{$out.$num.num}-->,'<!--{$val}-->')" >
					<img src="<!--{$out.static_url}-->/integral/images/points_<!--{$out.$num.id}-->.jpg"/>
					<div class="points_txt">
						<p><!--{$out.$num.name}--></p>
						<p>剩余数量：<span><!--{$out.$num.num}--></span></p>
					</div>
				</li>	
				<!--{/if}-->
			<!--{/foreach}-->	
				<li onclick="exchange_prize(2,0,20,'礼包')" >
					<img src="<!--{$out.static_url}-->/integral/images/points1_09.jpg"/>
					<div class="points_txt">
						<p>游戏尊贵礼包</p>
						<p>剩余数量：<span><!--{$out.surplus_gift_num}--></span></p>
					</div>
				</li>
				<div class="clear"></div>
			</ul>
		</div>
	</div>
</div>
<div class="main2">
	<div class="prize_index">
		<ul id="demo" style="overflow:hidden">
	<!--{if $out.top10_prize}-->
			<li id="demo1">
			<!--{foreach from=$out.top10_prize item='val' key='k'}-->
				恭喜用户<!--{$val.username}-->，兑换了<!--{$val.prizename}-->；<br/>
			<!--{/foreach}-->
			</li>
	<!--{else}-->		
			<li id="demo1"> 活动已开启，速度抢兑吧！</li>
	<!--{/if}-->		
			<li id="demo2"></li>
		</ul>
		<div class="line"></div>
	<!--{if $out['is_login'] == 1}-->
		<p>您今日还有<!--{$out.exchange_num}-->次兑奖机会<br/>tips：点击奖品立即抢兑吧！</p>
		<a href="/lottery/integral_userinfo.php?types=1" class="btns" style="margin:10px 0 0 75px">已兑换的奖品</a>	
	<!--{else}-->	
		<p>您今日还有5次兑奖机会<br/>tips：点击奖品立即抢兑吧！</p>
		<a href="<!--{$out.login_url}-->" class="btns" style="margin:10px 0 0 75px">已兑换的奖品</a>		
	<!--{/if}-->	
	</div>
	<a class="btns" href="http://promotion.anzhi.com/lottery/july_recharge_index.php?sid=<!--{$out.sid}-->">更多精彩</a>
</div>
<div class="main3">
	<div class="soft_wrap" >
		<ul class="soft-list" id="soft-list1"  >
		</ul>
		<ul class="soft-list" id="soft-list">
		</ul>
		<a href="javacript:;" class="soft_btn" onclick="change_soft();" ></a> 
	</div>
	<p class="slide_txt">* 充值流程参考</p>
	<div id="slideBox" class="slideBox">
		<div class="bd">
			<ul>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize1.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize2.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize3.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize4.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize5.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize6.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize7.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize8.jpg" /></a></li>
				<li><a href="javascript:;"><img src="<!--{$out.static_url}-->/integral/images/prize9.jpg" /></a></li>
			</ul>
		</div>
		<p>* 最终活动解释权归安智所有 *</p>
	</div>
</div>
<section>
    <div id="body-bg" style="display: none;"></div>
    <div class="tip-box mod" id="tip-box2"  style="display: none;">
        <div class="tip-mid">
            <div class="tip-con">
                <p id="notice" ></p>
				<div class="tip-btns">
					<a href="javascript:;"  class="btns" id ="btns_05" >确认</a>
					<a href="javascript:;" onclick="cloBox('#tip-box2')" class="btns" id="btns_03">返回</a>
				</div>
            </div>
			
        </div>
    </div>
</section>
<section>
    <div id="body-bg" style="display: none;"></div>
    <div class="tip-box mod" id="tip-box3"  style="display: none;">
        <div class="tip-mid">
            <div class="tip-con">
                <p id="notice3" ></p>
				<a href="javascript:;" onclick="cloBox('#tip-box3')" class="btns" id="clobox">返回</a>
            </div>
			
        </div>
    </div>
</section>

<script type="text/javascript">
    $(function(){
        //轮播图
        TouchSlide({
            slideCell:"#slideBox",
            mainCell:".bd ul",
            effect:"leftLoop",
            autoPlay:true //自动播放
        });
    })

var speed3=40//速度数值越大速度越慢
var demo= document.getElementById('demo');
var demo1= document.getElementById('demo1');
var demo2= document.getElementById('demo2');
<!--{if $out.top10_prize_count > 1}-->
	demo2.innerHTML=demo1.innerHTML
<!--{/if}-->	
	
function Marquee(){ 
	if(demo1.offsetHeight-demo.scrollTop<=0) 
		demo.scrollTop-=demo1.offsetHeight;
	else{ 
		demo.scrollTop++;
} 
}
var MyMar=setInterval(Marquee,speed3);



	var flags={canMove:true};
	function showOpenBox(obj){
		var bg_h=$("#body-bg").height()+$(document).scrollTop(),
				top_h= $(obj).height()/ 2-$(document).scrollTop();
		$(obj).css("margin-top",-top_h+"px").show();
		$("#body-bg").css("height",bg_h+"px").show();
		flags.canMove=false;
	}
    function cloBox(obj,type){
        $(obj).hide();
        $("#body-bg").hide();
        flags.canMove=true;
		if(type == 1)	location.reload();//加载页面	
    }	
	$(function(){
		$("body").bind('touchmove', function (e) {
			if(!flags.canMove){
				e.preventDefault();
			}
		});
	})

var proid_arr = getArgs();
var skinvc = proid_arr.skinvc;
function getArgs() {
	var args = {};
	var query = location.search.substring(1);
	var pairs = query.split("&");
	for(var i = 0; i < pairs.length; i++) {
			var pos = pairs[i].indexOf('=');
			if (pos == -1) continue;
			var argname = pairs[i].substring(0,pos);
			var value = pairs[i].substring(pos+1);
			value = decodeURIComponent(value);
			args[argname] = value;
	}
	return args;
}
var sid = '<!--{$out.sid}-->',img_url = '<!--{$out.img_url}-->';
var aid = '<!--{$out.aid}-->',p=0,soft_lists_go = [],soft_lists_anzhuang = [],flags={canMove:true};


function my_soft() {
	var json_data = window.AnzhiActivitys.getAllAppList(parseInt(aid));
	var cmd = 'var soft_list=' + json_data;
	eval(cmd);
	var soft_lists = soft_list.DATA;
	var open_list = [];
	var install_list = [];
	var down_list = [];
	for(j=0;j<soft_lists.length;j++){
		window.AnzhiActivitys.registerDownloadObserver(parseInt(soft_lists[j][0]));
		window.AnzhiActivitys.registerInstallObserver(soft_lists[j][7]);
		var json_data =  window.AnzhiActivitys.isInstalledApp(soft_lists[j][7],parseInt(soft_lists[j][13]));
		var soft_status_gos = window.AnzhiActivitys.getDownloadStateForActivity(parseInt(soft_lists[j][0]));
		if(json_data == 0 || json_data == 1 ){
			open_list.push(soft_lists[j]);
		}
		if(json_data == -2 && soft_status_gos == 5){
			install_list.push(soft_lists[j]);
		}
		if((json_data == -2 && soft_status_gos != 5 ) || json_data == -1){
			down_list.push(soft_lists[j]);
		}
	}      
  	for(var ii in open_list) {
		soft_lists_go.push(open_list[ii]);
	}  
  	for(var ii in install_list) {
		soft_lists_go.push(install_list[ii]);
	}
  	for(var ii in down_list) {
		soft_lists_go.push(down_list[ii]);
	}
	get_soft();
}


function get_soft(){
	var pagemax= Math.floor(soft_lists_go.length/5);
	if(soft_lists_go.length%5==0){
		pagemax = pagemax-1;
	}
	var data = soft_lists_go.slice(p*5,5*(p+1));
	if(data.length == 0){
		p = 0;
		data = soft_lists_go.slice(p*5,5*(p+1));
	}

	var str = '';
	var str1 = '';
	for(i = 0; i < data.length; i++) {
		if(data[i][2].length > 5){
			var softname = data[i][2].substring(0,3)+'...';
		}else{
			var softname = data[i][2];
		}
		var json_datas = window.AnzhiActivitys.getDownloadStateForActivity(parseInt(data[i][0]));
		var cmd = 'var soft_status=' + json_datas;
		eval(cmd);		
		if(data[i][2].length > 4){
			var softname = data[i][2].substring(0,3)+'...';
		}else{
			var softname = data[i][2];
		}	
		if(i == 1 || i == 0){	
			str1 += get_soft_li(soft_status,parseInt(data[i][0]),data[i][7],data[i][2],parseInt(data[i][13]),data[i][27],data[i][1]);
		}else{
			str += get_soft_li(soft_status,parseInt(data[i][0]),data[i][7],data[i][2],parseInt(data[i][13]),data[i][27],data[i][1]);
		}
	}
	$('#soft-list1').html(str1);
	$('#soft-list').html(str);

	if(p==pagemax){
		p=0;
	}else{
		p=p+1;
	}
}
function get_soft_li(soft_status,softid,my_package,softname,versioncode,size,src){
	if(soft_status == 1){
		var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft-icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a href="javacript:;" class="download" >下载中</a></p></li>';
	}else if(soft_status == 2 || soft_status == 3 || soft_status == 8){
		var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft-icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a id="'+softid+'" href="javacript:;" class="download" >继续</a></p></li>';
	}else if(soft_status == 4){
		var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft-icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a id="'+softid+'" href="javacript:;" class="download" >下载</a></p></li>';
	}else if(soft_status == 5){
		var soft_li = '<li onclick="installApp('+softid+',\''+my_package+'\')" ><p class="soft-icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a href="javacript:;" class="download" >安装</a></p></li>';
	}else if(soft_status == 6){
		var soft_li = '<li onclick="openApp(\''+my_package+'\','+softid+')" ><p class="soft-icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a href="javacript:;" class="download" >打开</a></p></li>';
	}else if(soft_status == 9){
		var soft_li = '<li onclick="installApp('+softid+',\''+my_package+'\')" ><p class="soft-icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a href="javacript:;" class="download" >校验中</a></p></li>';
	}else if(soft_status == 10){
		var soft_li = '<li><p class="soft-icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a id="'+softid+'" href="javacript:;" class="download" >已下载</a></p></li>';
	}else if(soft_status == -1){
		var soft_other_status = window.AnzhiActivitys.isInstalledApp(my_package,parseInt(versioncode));
		if(soft_other_status == -2){
			var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft-icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a id="'+softid+'" href="javacript:;" class="download" >下载</a></p></li>';
		}else if(soft_other_status == -1){
			var soft_li = '<li id="li_'+softid+'" onclick="go_softinfo_down('+softid+',\''+my_package+'\',\''+softname+'\','+versioncode+','+size+')" ><p class="soft-icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a id="'+softid+'" href="javacript:;" class="download" >更新</a></p></li>';
		}else if(soft_other_status == 0){
			var soft_li = '<li onclick="openApp(\''+my_package+'\','+softid+')" ><p class="soft-icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a href="javacript:;" class="download" >打开</a></p></li>';
		}else if(soft_other_status == 1){
			var soft_li = '<li ><p class="soft-icon"><a href="javascript:;"><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a id="'+softid+'" href="javacript:;" class="download" >已下载</a></p></li>';
			//var soft_li = '<li onclick="openApp(\''+my_package+'\','+softid+')" ><p class="soft-icon"><a href="javascript:;" ><img src="'+src+'"/></a></p><p class="soft-name">'+softname+'</p><p><a href="javacript:;" class="download" >打开</a></p></li>';
		}
	}
	return soft_li;
}
$(document).ready(function () {
	setTimeout(function(){
			my_soft();
	}, 500);
	$("body").bind('touchmove', function (e) {
		if(!flags.canMove){
			e.preventDefault();
		}
	});
});

function change_soft(){
	$('#soft-list').html('');
	$('#soft-list1').html('');
	get_soft();
}


function openApp(pkg,softid){

	the_soft = [softid];
	$.ajax({
		url: '/lottery/vacation_gift_open.php',
		data: 'softid='+softid+'&sid='+sid+'&package='+pkg+'&aid='+aid,
		type: 'get',
		success: function(data){
			window.AnzhiActivitys.openAppForActivity(pkg,the_soft);
		}
	});
}


function go_softinfo_down(softid,my_package,softname,versioncode,size){
	$.ajax({
		url: '/lottery/year_feedback_download.php',  //supwater  点击详情 点击下载
		data:"softid="+softid+"&sid="+sid+"&aid="+aid+"&pkgname="+my_package, 
		type:"post",
		success:function(data) {
			window.AnzhiActivitys.downloadForActivity(parseInt(aid),softid,my_package,softname,versioncode,size,0);
		},
	});
}

function onDownloadStateChanged(softid,newState){
	if(newState == 1){
		$('#'+softid+'').html("下载中");
	}else if(newState == 2){
		$('#'+softid+'').html("继续");
	}else if(newState == 3){
		$('#'+softid+'').html("继续");
	}else if(newState == 4){
		$('#'+softid+'').html("重试");
	}else if(newState == 5){
		$('#'+softid+'').html("安装");
		$('#li_'+softid+'').removeAttr("onclick");
		for(i=0;i < soft_lists_go.length;i++){
			if(soft_lists_go[i][0] == softid){
				$('#li_'+softid+'').attr('onclick',"installApp("+parseInt(softid)+",'"+soft_lists_go[i][7]+"')");

			}
		}
	}else if(newState == 6){
			$('#'+softid+'').html("打开");
			$('#'+softid+'').unbind('onclick');
			for(i=0;i < soft_lists_go.length;i++){
					if(soft_lists_go[i][0] == softid){
							$('#'+softid+'').bind('click',function(){
									openApp(soft_lists_go[i][7],softid);
							});
					}
			}
	}else if(newState == 8){
			$('#'+softid+'').html("继续");
	}else if(newState == 9){
			$('#'+softid+'').html("检查中");
	}
}

function installApp(softid,pkgname){
	$.ajax({
		url: '/lottery/vacation_third_install.php',
		data: 'softid='+softid+'&sid='+sid+'&package='+pkgname+'&aid='+aid,
		type: 'post',
		success: function(data){
			window.AnzhiActivitys.installAppForActivity(softid);
		}
	});
}


function exchange_prize(type,id,integral,prize,num,rank){
 <!--{if $out['is_login'] == 2}-->
 location.href="<!--{$out.login_url}-->";
 return false;
 <!--{/if}-->	
 	$.ajax({
		url: '/lottery/integral_kind_award.php',
		data:"log=1&sid="+sid+"&pid="+id+"&prizename="+prize+"&lottery_type="+type,
		type:"get",
		dataType: 'json',
		success:function(data) {
		},
	});		
	if(num <= 0){
		$("#notice3").html('奖品已被领完！');
		showOpenBox('#tip-box3');		
		return false;	
	}
	var rest_integral = parseInt("<!--{$out.rest_integral}-->");
	alert(rest_integral);
	if(rest_integral < parseInt(integral)){
		$("#notice3").html('您当前可用的积分不足，请充值获取积分');
		showOpenBox('#tip-box3');
		return false;
	} 
	var exchange_num = "<!--{$out.exchange_num}-->";
	if(exchange_num <= 0 ){
		$("#notice3").html('您今天可用的兑奖次数已用完');
		showOpenBox('#tip-box3');		
		return false;
	}

	var str =  "您今天可用剩余兑换次数为<!--{$out.exchange_num}-->次 " ;
	    str += "<br/>您当前可用积分为<!--{$out.rest_integral}-->";
	    str += "<br/>您确定花费"+integral+"积分兑换"+prize+"么？";
	$("#btns_05").attr('onclick', "exchange_prize_do("+type+","+id+","+integral+",'"+prize+"',"+rank+")");	
	$("#notice").html(str);
	showOpenBox('#tip-box2');
}

function exchange_prize_do(type,pid,integral,prizename,rank){
	cloBox('#tip-box2');
	if(type == 1){//实物
		$.ajax({
				url: '/lottery/integral_kind_award.php',
				data:"sid="+sid+"&pid="+pid+"&prizename="+prizename+"&prize_integral="+integral+"&rank="+rank,
				type:"post",
				dataType: 'json',
				success:function(data) {
					if(data.code == 1){
						location.href="/lottery/integral_userinfo.php?sid="+sid+"&types=2&prizename="+prizename;
					}else{
						$("#notice3").html(data.msg);
						$("#clobox").attr('onclick', "cloBox('#tip-box3',1)");	
						showOpenBox('#tip-box3');							
						return false;
					}
				},
		});		
	}else{//礼包
		location.href="/lottery/integral_gift.php?sid="+sid;
	}
}
</script>
</body>
</html>
