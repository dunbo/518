{// 加载头部公共文件 }
<include file="../../Public/header" />
<style type="text/css">

    body,td,th {
        font-size: 12px;
    }
    .tb{ border-top:1px solid #666666;border-left:1px solid #666666;}
    .tb th,.tb td{border-right:1px solid #666666; border-bottom:1px solid #666666;}

    .fixlong {
        table-layout: fixed;
    }
    .fixlong td {
        word-break: break-all;
    }
    .intb td {
        border-right:none;
        border-bottom: none;
    }
    .intb td {
        border-right:none;
        border-bottom: none;
    }
    .tb td{word-break:break-all; word-wrap:break-word;height: 30px;}
    .tb td.center{ text-align:center}

</style>

{//时间插件开始}
<script type="text/javascript" src="/Public/js/My97DatePicker/WdatePicker.js"></script>
{//时间插件结束}
<script src="/Public/img/common.js" type="text/javascript"></script>
<script type="text/javascript">zoomstatus = parseInt(1);
    var imagemaxwidth = '1000';
    var imagemaxheight = '600';
    var aimgcount = new Array();</script>
<!-- <link rel="stylesheet" href="/Public/css/thickbox.css" type="text/css" media="screen" />
        <script type="text/javascript" src='/Public/js/thickbox-compressed.js'></script> -->
<link rel="stylesheet" type="text/css" href="/Public/zoom/zoom.css" />
<script src="/Public/zoom/zoom.js"></script>
<script type="text/javascript" src="__PUBLIC__/school/js/jquery.zxxbox.3.0.js"></script>

<div class="main" >
    <div class="content">
        <center>
            <table width="100%"  border="0" cellpadding="0" cellspacing="0" class="tb">
                <tr height="35">
                    <td align="center" <?php if($status==1) { ?>style="background:#FFCC66"<?php } ?>><a href="__URL__/webanzhi_download_brush"><font style="color:#000; font-weight:bold">WWW下载刷量</font></a></td>
                    <td align="center" <?php if($status==2) { ?>style="background:#FFCC66"<?php } ?>><a href="__URL__/manzhi_download_brush"><font style="color:#000; font-weight:bold">M.anzhi.com下载刷量</font></a></td>
                    <td align="center" <?php if($status==3) { ?>style="background:#FFCC66"<?php } ?>><a href="__URL__/ip_download_brush"><font style="color:#000; font-weight:bold">IP下载刷量</font></a></td>
                    <td align="center" <?php if($status==4) { ?>style="background:#FFCC66"<?php } ?>><a href="__URL__/device_download_brush"><font style="color:#000; font-weight:bold">设备下载刷量</font></a></td>
                </tr>
            </table>
            <form method="get" action="__URL__/ip_download_brush">
                <table width="100%" border="0" cellpadding="0" cellspacing="0" class="tb">
                    <!--  <tr>
                       <td colspan="4" align="center"><h2>IP下载刷量列表</h2></td>
                           <td colspan="2" align="center"><font color="red">绿色</font>背景表示此软件在<a href="__URL__/brush_white_list">白名单列表</a>中</td>
                     </tr> -->
                    <tr>
                        <td align="left" colspan="5">
                            包名：

                            <input type="text" name="package" value="{$package}" size="20" />
                            &nbsp&nbsp
                            软件名：
                            <input type="text" name="softname"  value="{$softname}" size="20"/>
                            &nbsp&nbsp
                            IP下载超量总数≥：<input name="exceed_sum" value="{$exceed_sum}"/>

                            &nbsp&nbsp<input type="button" value="名词说明" id="word_exp" />
                        </td>
                        <td rowspan="2">
                            <input type="submit" value="搜索" style="width:150px" />
                        </td>
                    </tr>
                    <tr>
                        <td align="left" colspan="5"> 
                            起止时间：
                            <span><input type="text" name="start_time" id="start_time" value="{$start_time}" style="cursor: hand; width: 150px;" class="Wdate" onClick="WdatePicker({startDate: '%y-%M-%d 00:00:00', dateFmt: 'yyyy-MM-dd HH:mm:ss'})" /></span>~
                            <span><input id="end_time" name="end_time" style="cursor: hand; width: 150px;"
                                         value="{$end_time}" size="15" type="text" class="Wdate" onClick="WdatePicker({startDate: '%y-%M-%d 23:59:59', dateFmt: 'yyyy-MM-dd HH:mm:ss'})" /></span>
                            &nbsp&nbsp
                            <!-- <select name="order_go">
                                    <option value="1" <?php if($order_go == 1){ echo 'selected';} ?> >按包名排序</option>
                                    <option value="2" <?php if($order_go == 2){ echo 'selected';} ?> >按时间排序</option>
                            </select>
                            &nbsp;排序规则:&nbsp;<select name="order_rule">
                                    <option value="1" <?php if($order_rule == 1){ echo 'selected';} ?> >升序</option>
                                    <option value="2" <?php if($order_rule == 2){ echo 'selected';} ?> >降序</option>
                            </select> -->
                            是否显示白名单:
                            <select name="white_list">
                                <option value="1" <?php if($white_list == 1){ echo 'selected';} ?> >是</option>
                                <option value="0" <?php if($white_list == 0){ echo 'selected';} ?> >否</option>
                            </select>
                            &nbsp&nbsp
                            占下载总量比例≥：<input name="percent" value="{$percent}" />
                            <br>开发者昵称：<input name="dev_name" id="dev_name" value="{$dev_name}" />
                            &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp邮箱：<input name="email" id="email" value="{$email}" />
                            &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp开发者类型：
                            <select name="dev_type" id="dev_type">
                                <option value="3"  <?php if($dev_type == 3){ echo 'selected';} ?>>全部</option>
                                <option value="0"  <?php if($dev_type == 0){ echo 'selected';} ?>>公司</option>
                                <option value="1"  <?php if($dev_type == 1){ echo 'selected';} ?>>个人</option>
                            </select>
                            &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp开发者ID：
                            <input name="dev_id" id="dev_id" value="{$dev_id}" />

                        </td>
                    </tr>
                    <tr bgcolor="#C0C0C0">
                        <td colspan="6" align="left">
                            <span id="sum_data"></span>&nbsp&nbsp
                            <input id="oper_sum_data" value="下载量操作" type="button" >
                        </td>
                    </tr>
                </table>
            </form>
            <div style="float:left">{$count}条记录</div>
            <table width="100%" border="0" cellpadding="0" cellspacing="0" class="tb">
                <tr>
                    <td width="10%" align="center"  bgcolor="#e3e2fe">软件名</td>
                    <td width="10%" align="center"  bgcolor="#e3e2fe">包名
                <if condition="$_GET['order_rule'] eq '2'">
                    <a style="font-size:14px;font-weight:bold;" href="__URL__/ip_download_brush/order_go/1/order_rule/1/start_time/{$start_time}/end_time/{$end_time}/exceed_sum/{$exceed_sum}/percent/{$percent}" >↑</a>
                    <else/>
                    <a style="font-size:14px;font-weight:bold;" href="__URL__/ip_download_brush/order_go/1/order_rule/2/start_time/{$start_time}/end_time/{$end_time}/exceed_sum/{$exceed_sum}/percent/{$percent}" >↓</a>
                </if>
                </td>
                <td width="10%" align="center" bgcolor="#e3e2fe">开发者</td>
                <td width="5%" align="center"  bgcolor="#e3e2fe">备注</td>
                <td width="5%" align="center"  bgcolor="#e3e2fe"><label>&nbsp<input type="checkbox" onclick="selectAll('check_num', 'num_all')" rel="num" name="num_all" value="" />&nbsp&nbsp下载IP个数</label></td>
                <td width="5%" align="center"  bgcolor="#e3e2fe"><label>&nbsp<input type="checkbox" onclick="selectAll('check_total', 'total_all')" rel="total" name="total_all" value="" />&nbsp&nbspIP下载总数</label></td>
                <td width="5%" align="center"  bgcolor="#e3e2fe"><label>&nbsp<input type="checkbox" onclick="selectAll('check_day', 'day_all')" rel="day" name="day_all" value="" />&nbsp&nbsp当天下载总量</label></td>
                <td width="5%" align="center"  bgcolor="#e3e2fe">IP超量占比</td>
                <td width="5%" align="center"  bgcolor="#e3e2fe">刷量日期</td>
                <td width="6%" align="center" bgcolor="#e3e2fe">最近操作记录</td>
                <td width="5%" align="center" bgcolor="#e3e2fe">软件状态</td>
                <td width="6%" align="center" bgcolor="#e3e2fe">操作</td>
                </tr>
                <?php if(isset($brush_list)):?>
                <volist name="brush_list" id="vo">
                    <if condition="$vo.white eq 1">
                        <tr bgcolor="#00FF00">
                            <td width="5%" align="center">
                                <input type="hidden" value="{$vo.his_add_data}" />
                                <input type="hidden" value="{$vo.his_cut_data}" />
                                <input type="hidden" value="{$vo.soft_total_data}" />
                        <if condition="$vo.softname eq '0'">
                            <font color="cyan">软件已失效</font>
                            <else />
                            <a href="/index.php/Dev/Soft/softlist/package/{$vo.package}" target="_blank">{$vo.softname}</a>
                        </if></td>
                        <td width="5%" align="center"><a href="__URL__/ip_download_brush/package/{$vo.package}" target="_blank">{$vo.package}</a></td>
                        <td width="10%" align="center" bgcolor="#e3e2fe">
                             <!----------通过---------->
                        <if condition="$vo.status eq 0">
                        <a target='_blank' href='/index.php/Dev/User/userlists/dev_id/{$vo.dev_id}'>
                        <!----------审核中---------->
                        <elseif condition="$vo.status eq 1" />
                        <a target='_blank' href='/index.php/Dev/User/auditforuser/dev_id/{$vo.dev_id}'>
                        <!----------驳回---------->
                        <elseif condition="$vo.status eq '-1' " />
                        <a target='_blank' href='/index.php/Dev/User/reject_users/dev_id/{$vo.dev_id}'>
                        <!----------屏蔽---------->
                        <elseif condition="$vo.status eq '-2' " />
                        <a target='_blank' href='/index.php/Dev/User/shield_users/dev_id/{$vo.dev_id}'>
                        </if>{$vo.dev_name}</a><br>{$vo.dev_id}<br>{$vo.dev_type}<br>
                        <a target='_blank' href='__URL__/ip_download_brush/email/{$vo.email}'>{$vo.email}</a></td>
                        <td width="5%" align="center"><?php if($vo['note'] == '' || !isset($vo['note'])) echo '&nbsp;'; else echo '<a target="_blank" href="__URL__/brush_white_list/package/'.$vo['package'].'">'.$vo['note'].'</a>';?></td>
                        <td width="5%" align="center"><label>&nbsp<input type="checkbox" class="check_num sum_data" rel="num" name="{$vo.package}" value="{$vo.ip_num}" />&nbsp&nbsp{$vo.ip_num}</label></td>
                        <td width="5%" align="center"><label>&nbsp<input type="checkbox" class="check_total sum_data" rel="total" name="{$vo.package}" value="{$vo.exceed_sum}" />&nbsp&nbsp{$vo.exceed_sum}</label></td>
                        <td width="5%" align="center"><label>&nbsp<input type="checkbox" class="check_day sum_data" rel="day" name="{$vo.package}" value="{$vo.download_sum}" />&nbsp&nbsp{$vo.download_sum}</label></td>
                        <td width="5%" align="center">{$vo.percent}</td>
                        <td width="5%" align="center" rel="{$vo.brush_time}">{$vo.brush_time|date='Y-m-d',###|default='&nbsp;'}</td>
                        <td width="5%" align="center"><a  href="/index.php/Dev/LogStatic/log_static_view/actionexp/{$vo.package}/action_id/{$action_id}" target="_blank">{$vo.reason}<br /><if condition= "$vo.brush_type neq ''">{$vo.brush_type}:{$vo.brush_num}<br/></if>{$vo.log_time|default='&nbsp;'}</a></td>
                        <td width="5%" align="center"><?php if($vo['hide'] == 0){ echo '历史';}else if($vo['hide'] == 1){ echo '上架';}else if($vo['hide'] == 2){ echo '新软件';}else if($vo['hide'] == 3){ echo '下架';}else if($vo['hide'] == 4){ echo '软件编辑';}else if($vo['hide'] == 5){ echo '更新软件';}else if($vo['hide'] == 6){ echo '驳回';}else if($vo['hide'] == 7){ echo '驳回审核';}?></td>
                        <td width="6%" align="center"><input type="button" value="查看近期" onclick="show_log('{$vo.package}')" /></td>
                        </tr>
                    </if>
                    <if condition="$vo.white eq 0">
                        <tr>
                            <td width="5%" align="center">
                                <input type="hidden" value="{$vo.his_add_data}" />
                                <input type="hidden" value="{$vo.his_cut_data}" />
                                <input type="hidden" value="{$vo.soft_total_data}" />
                        <if condition="$vo.softname eq '0'">
                            <font color="cyan">软件已失效</font>
                            <else />
                            <a href="/index.php/Dev/Soft/softlist/package/{$vo.package}" target="_blank">{$vo.softname}</a>
                        </if></td>
                        <td width="5%" align="center"><a href="__URL__/ip_download_brush/package/{$vo.package}" target="_blank">{$vo.package}</a></td>
                        <td width="10%" align="center" bgcolor="#e3e2fe">
                             <!----------通过---------->
                        <if condition="$vo.status eq 0">
                        <a target='_blank' href='/index.php/Dev/User/userlists/dev_id/{$vo.dev_id}'>
                        <!----------审核中---------->
                        <elseif condition="$vo.status eq 1" />
                        <a target='_blank' href='/index.php/Dev/User/auditforuser/dev_id/{$vo.dev_id}'>
                        <!----------驳回---------->
                        <elseif condition="$vo.status eq '-1' " />
                        <a target='_blank' href='/index.php/Dev/User/reject_users/dev_id/{$vo.dev_id}'>
                        <!----------屏蔽---------->
                        <elseif condition="$vo.status eq '-2' " />
                        <a target='_blank' href='/index.php/Dev/User/shield_users/dev_id/{$vo.dev_id}'>
                        </if>{$vo.dev_name}</a><br>{$vo.dev_id}<br>{$vo.dev_type}<br>
                        <a target='_blank' href='__URL__/ip_download_brush/email/{$vo.email}'>{$vo.email}</a></td>
                        <td width="5%" align="center">&nbsp;</td>
                        <td width="5%" align="center"><label>&nbsp<input type="checkbox" class="check_num sum_data" rel="num" name="{$vo.package}" value="{$vo.ip_num}" />&nbsp&nbsp{$vo.ip_num}</label></td>
                        <td width="5%" align="center"><label>&nbsp<input type="checkbox" class="check_total sum_data" rel="total" name="{$vo.package}" value="{$vo.exceed_sum}" />&nbsp&nbsp{$vo.exceed_sum}</label></td>
                        <td width="5%" align="center"><label>&nbsp<input type="checkbox" class="check_day sum_data" rel="day" name="{$vo.package}" value="{$vo.download_sum}" />&nbsp&nbsp{$vo.download_sum}</label></td>
                        <td width="5%" align="center">{$vo.percent}</td>
                        <td width="5%" align="center" rel="{$vo.brush_time}">{$vo.brush_time|date='Y-m-d',###|default='&nbsp;'}</td>
                        <td width="5%" align="center"><a  href="/index.php/Dev/LogStatic/log_static_view/actionexp/{$vo.package}/action_id/{$action_id}" target="_blank">{$vo.reason}<br /><if condition= "$vo.brush_type neq ''">{$vo.brush_type}:{$vo.brush_num}<br/></if>{$vo.log_time|default='&nbsp;'}</a></td>
                        <td width="5%" align="center"><?php if($vo['hide'] == 0){ echo '历史';}else if($vo['hide'] == 1){ echo '上架';}else if($vo['hide'] == 2){ echo '新软件';}else if($vo['hide'] == 3){ echo '下架';}else if($vo['hide'] == 4){ echo '软件编辑';}else if($vo['hide'] == 5){ echo '更新软件';}else if($vo['hide'] == 6){ echo '驳回';}else if($vo['hide'] == 7){ echo '驳回审核';}?></td>
                        <td width="6%" align="center"><input type="button" value="查看近期" onclick="show_log('{$vo.package}')" /></td>
                        </tr>   
                    </if>
                </volist>
                <?php else: ?>
                <tr>
                    <td align="center" colspan="12">暂无记录</td>
                </tr>
                <?php endif; ?>
                <tr bgcolor="#C0C0C0">
                    <td align="left" colspan="12">
                        <span id="sum_data_bottom"></span>&nbsp;&nbsp;
                        <input type="button" value="下载量操作" onclick="oper_sum_data();" id="oper_sum_bottom">
                    </td>
                </tr>
            </table>
            {$page}
        </center>
        <div id="open" style="padding:10px; width:450px; height:320px;display:none;">
            <h2>刷量操作</h2>
            <form id="brush_oper" method="post" action="__URL__/brush_oper" onsubmit="return form_chk()" style="width:100%;height:100%;">
                <table>
                    <tr>
                        <td>软件名称：</td><td id="softname" align="left"></td><td>软件包名：</td><td id="package" align="left"></td>
                    </tr>
                    <tr>
                        <td>操作原因：</td><td colspan="3"><label><input type="checkbox" value="刷量" name="oper_reason[]">&nbsp刷量</label>&nbsp&nbsp<label><input type="checkbox" value="数据转移" name="oper_reason[]"  />&nbsp数据转移</label>&nbsp&nbsp<label><input type="checkbox" value="其它" id="oper_reason_other">&nbsp其它</label></td>
                    </tr>
                    <tr>
                        <td>&nbsp</td><td colspan="3"><input type="text" value="" id="oper_reason" name="oper_reason[]"  style="display:none" /></td>
                    </tr>
                    <tr>
                        <td colspan="4">软件下载总量：<span id="download_day"></span></td>
                    </tr>
                    <tr>
                        <td colspan="4"><label><input type="radio" value="0" checked="checked" name="is_count" />&nbsp扣量值</label>&nbsp&nbsp<label><input type="radio" value="1" name="is_count"  />&nbsp增量值</label></td>
                    </tr>
                    <tr>
                        <td colspan="4"><input type="text" id="total_sum"  value="">X<select id="multiple"><option value="1">1倍</option><option value="2">2倍</option><option value="3">3倍</option><option value="4">4倍</option><option value="5">5倍</option></select><span id="count_num"></span></td>
                    </tr>
                    <tr>
                        <td colspan="4">历史增量值：<span id="his_add_data"></span><br />历史扣量值：<span id="his_cut_data"></span><br />软件剩余量：<span id="soft_last_data" style="color:#F00"></span><input type="hidden" name="soft_last_data" value=""></td>
                    </tr>
                    <tr>
                        <td colspan="4">注：软件剩余量=下载总量+本次增量值-本次扣量值+历史增量值-历史扣量值<br />
                            根据公式系统自动算出结果<br />
                            历史增扣量值为该软件进行历史增扣量操作累计数值</td>
                    </tr>
                    <tr><td colspan="4" align="center">
                            <input type="hidden" name="package" id="data_package" value="">
                            <input type="hidden" name="type" value="3">
                            <input type='button'  id='sub' value="确定" style="width:100px;" />&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                            <input type='button'  value="取消" onclick="closes()" style="width:100px;" />
                        </td></tr>
                </table>
            </form>
        </div>
        <div id="word" style="padding:10px; width:350px; height:160px;display:none;">
            <h2>名词说明</h2>
            <table>
                <tr>
                    <td align="right">IP下载个数：</td><td>该软件下载超量的IP个数</td>
                </tr>
                <tr>
                    <td align="right">IP下载总数：</td><td>该软件IP下载超量的合计统计</td>
                </tr>
                <tr>
                    <td align="right">当天下载总量：</td><td>软件当天的下载总数量</td>
                </tr>
                <tr>
                    <td align="right">IP超量占比：</td><td>IP下载总数/当天下载总量</td>
                </tr>
                <tr>
                    <td align="center" colspan="2"><input type='button'  value="关闭" onclick="closes()"/></td>
                </tr>
            </table>
        </div>
        <div id="show_log" style="padding:10px; width:450px;height:120px;display:none;">
            <h2>查看近期</h2>
            <form id="show_log_from" method="get" action="__URL__/ip_download_brush" target="_blank" style="width:100%;height:100%;">
                <table>
                    <tr>
                        <td>起止时间：</td>
                        <td>
                            <span><input type="text"  id="log_start_time"  name="start_time" value="" style="cursor: hand; width: 150px;height:30px;" class="Wdate" onClick="WdatePicker({startDate: '%y-%M-%d 00:00:00', dateFmt: 'yyyy-MM-dd HH:mm:ss'})" /></span>~
                            <span><input id="log_end_time" name="end_time" style="cursor: hand; width: 150px;height:30px;"
                                         value="" size="15" type="text" class="Wdate" onClick="WdatePicker({startDate: '%y-%M-%d 23:59:59', dateFmt: 'yyyy-MM-dd HH:mm:ss'})" /></span></td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">
                            <input type="hidden"  name="package" id="log_package" value="">
                            <input type="hidden" name="type" value="3">
                            <input type='button'  id='show_log_sub' value="确定" />
                            <input type='button'  value="取消" onclick="closes()"/>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <script type="text/javascript">
            function oper_sum_data() {
                var names = '';
                var package_num = [];
                $('input.sum_data').each(function() {
                    if ($(this).attr('checked')) {
                        names = $(this).attr('name');
                        if (!!names) {
                            package_num.push(names);
                        }
                    }

                });
                if (ov4(package_num).length > 1) {
                    alert('请选择同一个软件!');
                    return false;
                }
                if (names == '') {
                    alert('请选择要刷量的软件数据！');
                    return false;
                }
                var str = '', sum_data = 0, web_data = 0, bd_data = 0, tx_data = 0, wdj_data = 0, day_data = 0, softname = '', time = '', max_day = 0, download_day = '', his_add_data = 0, his_cut_data = 0, total_download = 0;

                $("input[name='" + names + "']:checked").each(function() {
                    str += $(this).val() + '+';
                    sum_data += Number($(this).val());
                    softname = $(this).closest('tr').find('td').eq(0).text();
                    his_add_data = $(this).closest('tr').find('td').eq(0).children('input').eq(0).val();
                    his_cut_data = $(this).closest('tr').find('td').eq(0).children('input').eq(1).val();
                    total_download = $(this).closest('tr').find('td').eq(0).children('input').eq(2).val();
                    time = $(this).closest('tr').find('td').eq(7).attr('rel');
                    /*download_day = $(this).closest('tr').find('td').eq(5).text();
                     if(max_day != 0){
                     if(max_day<time) max_day = download_day;
                     }else{							
                     max_day = download_day;
                     }*/
                });
                max_day = total_download;
                str = str.substring(0, str.length - 1);
                $('#count_num').html('&nbsp&nbsp' + sum_data * $('#multiple').val());
                $('input[name=soft_last_data]').val(sum_data * $('#multiple').val());
                var is_count = 1;
                $("input[name='is_count']:checked").each(function() {
                    is_count = $(this).val(); //判断增量或者减量
                });
                count_number(is_count, max_day, sum_data, his_add_data, his_cut_data);
                $("input[name='is_count']").click(function() {
                    $("input[name='is_count']:checked").each(function() {
                        is_count = $(this).val(); //判断增量或者减量
                        var sum_data = $('#total_sum').val();
                        count_number(is_count, max_day, sum_data, his_add_data, his_cut_data);
                    });
                });
                $('#sum_data').html('&nbsp&nbsp' + str + '=' + sum_data);
                $('#sum_data_bottom').html('&nbsp&nbsp' + str + '=' + sum_data);
                $('#total_sum').val(sum_data);
                $('#softname').html(softname);
                $('#package').html(names);
                $('#data_package').val(names);
                $('#his_add_data').html(his_add_data);
                $('#his_cut_data').html(his_cut_data);
                $('#download_day').html(total_download);
                $("#open").zxxbox();
            }
            $('#oper_sum_data').click(function() {
                oper_sum_data();
            });
        </script>
        <script type="text/javascript" src="/Public/js/brush.js"></script>
        <include file="../Public/footer" />
