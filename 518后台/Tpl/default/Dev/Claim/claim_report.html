{// 加载头部公共文件 }
<include file="../../Public/header" />
<style type="text/css">

body,td,th {
	font-size: 12px;
}
.tb{ border-top:1px solid #666666;border-left:1px solid #666666;}
.tb th,.tb td{border-right:1px solid #666666; border-bottom:1px solid #666666;}

.fixlong {
  table-layout: fixed;
}
.fixlong td {
  word-break: break-all;
}
.intb td {
border-right:none;
border-bottom: none;
}
.intb td {
border-right:none;
border-bottom: none;
}
.tb td{word-break:break-all; word-wrap:break-word;}
.tb td.center{ text-align:center}

</style>

{//时间插件开始}
<script type="text/javascript" src="/Public/js/My97DatePicker/WdatePicker.js"></script>
{//时间插件结束}

<!-- <link rel="stylesheet" type="text/css" href="/Public/img/common.css" /> -->
<script src="/Public/img/common.js" type="text/javascript"></script>
<script type="text/javascript">zoomstatus = parseInt(1);var imagemaxwidth = '1000';var imagemaxheight = '600';var aimgcount = new Array();</script>
<!-- <link rel="stylesheet" href="/Public/css/thickbox.css" type="text/css" media="screen" />
<script type="text/javascript" src='/Public/js/thickbox-compressed.js'></script> -->
<link rel="stylesheet" type="text/css" href="/Public/zoom/zoom.css" />
<script src="/Public/zoom/zoom.js"></script>
<script type="text/javascript" src="__PUBLIC__/school/js/jquery.zxxbox.3.0.js"></script>

<div id="append_parent"></div>

<div class="main" >
<div class="content">
<center>
<table width="100%"  border="0" cellpadding="0" cellspacing="0" class="tb">
	<tr height="35">
		<td align="center" <?php if($status_type=='1') { ?>style="background:#FFCC66"<?php } ?>><a href="__URL__/report_list/status_type/1"><font style="color:#000; font-weight:bold">&nbsp;未&nbsp;处&nbsp;理&nbsp;</font></a></td>
		<td align="center" <?php if($status_type=='2') { ?>style="background:#FFCC66"<?php } ?>><a href="__URL__/report_list/status_type/2"><font style="color:#000; font-weight:bold">&nbsp;已&nbsp;处&nbsp;理&nbsp;</font></a></td>
		<td align="center" <?php if($status_type=='0') { ?>style="background:#FFCC66"<?php } ?>><a href="__URL__/report_list/status_type/0"><font style="color:#000; font-weight:bold">&nbsp;已&nbsp;删&nbsp;除&nbsp;</font></a></td>
	</tr>
</table>
<form  method='get' action="__URL__/report_list" >
<table width="100%" height="39" border="0" cellpadding="0" cellspacing="0" class="tb">
  <tr>
    
    <td width="99">开发者：</td>
    <td width="130"><input type="text" size="15" name="dev_name" value="<?php echo $_GET['dev_name']; ?>" /></td>
	<td width="80">起止日期：</td>
	<td width="350" colspan='3'><span><input type="text" name="begintime" id="begintime" value="<?php echo $_GET['begintime']; ?>" style="cursor: hand; width: 120px;" class="Wdate" onClick="WdatePicker({startDate:'%y-%M-%d 00:00:00',dateFmt:'yyyy-MM-dd HH:mm:ss'})" /></span>~
	<span>
	<input id="endtime" name="endtime" style="cursor: hand; width: 120px;"		 value="<?php echo $_GET['endtime']; ?>" size="15" type="text" class="Wdate" onClick="WdatePicker({startDate:'%y-%M-%d 23:59:59',dateFmt:'yyyy-MM-dd HH:mm:ss'})" /></span></td>
    <td width="99">注册邮箱：</td>
	<td width="140"><input type="text" size="15" name="email" value="<?php echo $_GET['email']; ?>" /></td>
    <td rowspan="2"><input type="hidden" name="status_type" value="{$status_type}"><input type="submit" name="button" id="button" value="&nbsp;搜 索&nbsp;"  /></td>	
    <tr>
        <td width="99">举报内容：</td>
    	<td width="130"><input type="text" size="15" name="content"  value="<?php echo $_GET['content']; ?>" /></td>
    	<if condition="$status_type neq '1'">
    	<td>回复内容：</td><td><input value="<?php echo $_GET['reply']; ?>" name="reply" /></td>
    	<td colspan="5"></td>
    	<else/>
    	<td colspan="7"></td>
    	</if>
    </tr>
    
    <!-- <td width="99">读取状态：</td>
    <td width="166"><select id="read_type" name="read_type">
		<option value="" selected="selected" >全部</option>
		<option value="1"<if condition="$read_type eq '1'">selected="selected"</if>>未读</option>
		<option value="2"<if condition="$read_type eq '2'">selected="selected"</if>>已读</option>
	</select></td>    -->
<!-- 	<td width="99">处理状态：</td>
    <td width="100">
	<select id="status_type" name="status_type">
		<option value="" selected="selected" >全部</option>
		<option value="1"<if condition="$status_type eq '1'">selected="selected"</if>>审核中</option>
		<option value="2"<if condition="$status_type eq '2'">selected="selected"</if>>已回复</option>
	</select></td> -->
  </tr>
  <tr>

  </tr>
</table>
</form>
<br />
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="tb fixlong">
  <tr>
    <td align='center' width="5%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold"><input type="checkbox" value="全选" onclick="selectAll();">全选</font></td>
    <td align='center' width="10%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">开发者</font></td>
    <td align='center' <if condition="$status_type neq '1'">  width="10%" <else/> width="30%"  </if> width="30%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">举报描述</font></td>
    <td align='center' width="30%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">盗版链接</font></td>
    <td align='center' width="5%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">认证材料</font></td>
    <if condition="$status_type neq '1'">
    <td align='center' width="15%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">回复内容</font></td>
    </if>
    <!-- <td align='center' width="5%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">读取状态</font></td> -->
    <td align='center' width="5%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">处理状态</font></td>
    <td align='center' width="10%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">举报时间</font></td>
   <td align='center' width="5%" height="30" bgcolor="#e3e2fe" ><font style="color:#000; font-weight:bold">操作</font></td>
  </tr>
  <volist name='list' id='val'>
 <tr>
	<td><input type="checkbox" name="id[]" id="{$val.id}"/>
	</td>
    <td align='left'>
    <a href=" /index.php/Dev/User/developer_list/dev_id/{$val.dev_id}/user_type/1">{$val.dev_name}</a><br/>
    【{$val.dev_type}】<br/>
	Email:{$val.dev_email}
	</td>
	<td align='left'>
	{$val.content}
	</td>
	<td align='left'>
	
	<foreach name="val.links" item="v">
	<a target="_blank" href='/index.php/Dev/Soft/global_search/package/<?php $softid = substr($v,strrpos($v,'_')+1,-5); echo $val['icon'][$softid]['apk_name']; ?>'>
	<img src='<?php  $softid = substr($v,strrpos($v,'_')+1,-5); echo IMGATT_HOST.$val['icon'][$softid]['iconurl'];?>' width="48" height="48"/></a>
  	 <a target="_blank"  href="{$v}"> {$v}</a></br>
	</foreach>
	
    </td>
    <td align='center'>
    <a href="javascript:showFile({$val.id})">查看附件</a>
    </td>
    <if condition="$status_type neq '1'">
    <td align='left'>
    <if condition="$val.reply eq '0'">
 &nbsp
    <else /> 
 {$val.reply_time|date="Y-m-d H:i:s",###}<br />
 {$val.reply}
	</if>
    </td>
    </if>
	<!-- <td align='center'>
	<if condition="($val.isread eq '1')"> 
	已读
	<else />
          未读
	</if>
	</td> -->
	<td align='center'>
 	<if condition="($val.status eq '1')"> 
	审核中
	<else />
         已回复
	</if>
	</td>
	<td style="align:center;"> 
	<div style='width:70px'>
	{$val.add_time|date="Y-m-d H:i:s",###}
	</div>
	</td>
    <td style="text-align:center;">
    <button onclick="reply('{$val.id}');">回&nbsp;复</button><br/>
	<?php if($status_type !='0') { ?>
	<button onclick="deleteOne('{$val.id}')">删&nbsp;除</button>
	<?php } ?>
	</td>
  </tr>
  </volist>
  <tr  height="50">
  <td colspan="9">
     <input type="checkbox" onclick="selectAll();" />
	 <?php if($status_type !='0') { ?>
		<button style="margin-left:15px;" onclick="deleteAll();">批量删除</button>
	 <?php } ?>
  </td>
  </tr>
</table>
<div  align='left'>{$page}</div>
</center>
</div>
</div>
<div id="open" style="padding:10px; width:300px; height:300px;   display:none;">
		<h2>安智回复</h2>
		<textarea style="height:180px;width:100%;" id="info"></textarea>	<br />
		<input type='button'  id='sub' value="确定" />
		<input type='button'  value="取消" onclick="closes()"/>
</div>
<div id="open_showfile" style="padding:10px; width:500px; height:auto;   display:none;">
		<h2>投诉举报</h2>
		<div id="links"></div>
<ul id="images"></ul>
<ul id="pdfs"></ul>
		<div style="clear:both"></div>
		
		<input type='button'  value="关闭" onclick="closes()" style="width:100px;height:35px;margin-left:200px;float:left"/>
		<div style="clear:both"></div>
</div>
<style>
ul li{list-style: none outside none;margin:0;padding:0}
#images li ,#pdfs li{width:120px;float:left;margin:5px;}

</style>
<script>
function deleteOne(pid){
	if (!confirm("确定要删除该项么？"))
		return false;
	window.location="__URL__/report_del/id/%5b%22" + pid + "%22%5d";
}
var flag = false;
function selectAll(){
	if(!flag){
		$("[name='id[]']").each(function(){
			$(this).attr('checked',true);
		});
		
		flag = true;
		return;
	}
	if(flag){
		$("[name='id[]']").each(function(){
			$(this).attr('checked',false);
		});
		
		flag = false;
		return;
	}	
}
function deleteAll(){

	var count = 0;
	var id = new Array();
	checkall = document.getElementsByTagName("input");
	for (i = 0; i < checkall.length; i++)
	{
		if (checkall[i].type == "checkbox" && checkall[i].checked == true)
		{
			id[count] = checkall[i].id;
			count++;
		}
	}
	if(id==''){
		alert('请选择相关软件！');
		return false;
	}
	if (!confirm("确定要删除选定项么？"))
		return false;
	
	url = encodeURI(JSON.stringify(id));
	url = "__URL__/report_del/id/" + url;
	window.location = url;
}


function reply(id){
	$("#open").zxxbox();
	$('#sub').click(function(){
		var reply = $.trim($('#info').val());
		var data = '&reply='+reply+'&id='+id;
		if(!!id && !!reply){
			$.ajax({ 
				url: '__URL__/report_reply',
				type: 'POST',
				data: data,
				dataType: 'json',
				success: function(data){
						if(!!data && data.success){ 
							 alert(data.msg);
							 window.location.href="__URL__/report_list";
						}else{
							if(data.msg){
								alert(data.msg);
							}else if(data.info &&　ret.status == 0){
								alert(data.info);
							}else{
								alert('未知错误！');
							} 
							 window.location.href="__URL__/report_list";
						}
				},
			    error: function(){
			    	
		  	      alert('对不起，服务器错误，请联系管理员！');
		  		}
			});
		}else{
			
			 alert('请输入正确信息！');
		}
	});
}
function showFile(id){
	
	var data = '&id='+id;
	$.ajax({ 
		url: '__URL__/show_file',
		type: 'POST',
		data: data,
		dataType: 'json',
		success: function(data){
				if(!!data && data.success){
					var links_centent  = '',images = '',pdfs = '';
					var status  = data.rows.status;
					var reply = data.rows.reply;
					links_centent+='举报描述：<textarea  rows="3" cols="40" disabled >'+data.rows.content+'</textarea><br /><br />';
					$.each(data.rows.links,function(i,n){
						links_centent+='盗版链接：<input type="text" value="'+n+'" style="width:250px;" disabled /><br />';
					});
					   
					$.each(data.rows.files,function(i,n){
						var istype = n.substr(n.length-3).toLowerCase();
						if(istype=='jpg' || istype=='png'){
							images+='<li><a href="<?php echo IMGATT_HOST;?>'+n+'" target="_blank"> <img width="120" src="<?php echo IMGATT_HOST;?>'+n+'" /></li></a>';
						}else{
							pdfs+='<li><a href="<?php echo IMGATT_HOST;?>'+n+'" target="_blank">'+n+'</a></li>';
						}
					});
					if(status==2 && !!reply){
						$('#reply').html(reply);
					}
					$('#links').html(links_centent);
					$('#images').html(images);
					$('#pdfs').html(pdfs);
					$("#open_showfile").zxxbox();
				}else{
					dev_alert('对不起，无法获取信息！');  
				}
		}
	});
}
//关闭弹出层
function closes(){
	$.zxxbox.hide();
	window.location.reload();
}
</script>
<!-- 主页面结束 -->
{// 加载尾部公共文件 }
 