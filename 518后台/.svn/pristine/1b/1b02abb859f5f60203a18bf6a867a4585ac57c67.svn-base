<include file="../../Public/header" />
<script type="text/javascript" src='__PUBLIC__/js/jquery.js'></script>
<link type="text/css" href="/Public/css/co_common.css" rel="stylesheet" />
<link type="text/css" href="/Public/css/checkout.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" media="all"
	href="/Public/js/calendar-win2k-cold-1.css" title="win2k-cold-1" />
<script type="text/javascript" src="/Public/js/calendar_bak.js"></script>
<script type="text/javascript" src="/Public/js/calendar-zh.js"></script>
<script type="text/javascript" src="/Public/js/calendar-setup.js"></script>
<script>
	$(document).ready(function(){
		var my_order = $('#my_order').val();
		if(my_order == 1){
			$('#nincome').removeClass('arrow_down');
			$('#pre_deduct').removeClass('arrow_down');
			$('#income').addClass('arrow_up');
		}else if(my_order == 2){
			$('#nincome').removeClass('arrow_down');
			$('#pre_deduct').removeClass('arrow_down');
			$('#income').addClass('arrow_down');
		}else if(my_order == 3){
			$('#income').removeClass('arrow_down');
			$('#pre_deduct').removeClass('arrow_down');
			$('#nincome').addClass('arrow_up');
		}else if(my_order == 4){
			$('#income').removeClass('arrow_down');
			$('#ratio').removeClass('arrow_down');
			$('#nincome').addClass('arrow_down');
		}else if(my_order == 6){
			$('#income').removeClass('arrow_down');
			$('#nincome').removeClass('arrow_down');
			$('#pre_deduct').addClass('arrow_down');
		}else if(my_order == 5){
			$('#income').removeClass('arrow_down');
			$('#nincome').removeClass('arrow_down');
			$('#pre_deduct').addClass('arrow_up');
		}else if(my_order == 7){
			$('#income').removeClass('arrow_down');
			$('#nincome').removeClass('arrow_down');
			$('#ratio').addClass('arrow_up');
		}else if(my_order == 8){
			$('#income').removeClass('arrow_down');
			$('#nincome').removeClass('arrow_down');
			$('#ratio').addClass('arrow_down');
		}else{
			$('#income').removeClass('arrow_down');
			$('#nincome').removeClass('arrow_down');
			$('#pre_deduct').removeClass('arrow_down');
		}
	
	});


	function order_by_income(){
		$('#nincome').removeClass('arrow_down');
		$('#pre_deduct').removeClass('arrow_down');
		$('#ratio').removeClass('arrow_down');
		var order_by_num = $('#order_income').val();
		if(order_by_num == 1 || !order_by_num){
			$('#income').addClass('arrow_up');
			$('#order_income').val(2);
		}else{
			$('#income').addClass('arrow_down');
			$('#order_income').val(1);
		}
		$('#my_order').val($('#order_income').val());

		search_all.submit();
	}
	
	function order_by_nincome(){
		$('#income').removeClass('arrow_down');
		$('#pre_deduct').removeClass('arrow_down');
		$('#ratio').removeClass('arrow_down');
		var order_by_num = $('#order_nincome').val();
		if(order_by_num == 3 || !order_by_num){
			$('#nincome').addClass('arrow_up');
			$('#order_nincome').val(4);
		}else{
			$('#nincome').addClass('arrow_down');
			$('#order_nincome').val(3);
		}
		$('#my_order').val($('#order_nincome').val());
		search_all.submit();
	}
	
	function order_by_deduct(){
		$('#income').removeClass('arrow_down');
		$('#nincome').removeClass('arrow_down');
		$('#ratio').removeClass('arrow_down');
		var order_by_num = $('#order_deduct').val();
		if(order_by_num == 5 || !order_by_num){
			$('#pre_deduct').addClass('arrow_down');
			$('#order_deduct').val(6);
		}else{
			$('#pre_deduct').addClass('arrow_up');
			$('#order_deduct').val(5);
		}
		$('#my_order').val($('#order_deduct').val());
		
		search_all.submit();
	}
	
	function order_by_ratio(){
		$('#income').removeClass('arrow_down');
		$('#nincome').removeClass('arrow_down');
		$('#pre_deduct').removeClass('arrow_down');
		var order_by_num = $('#order_ratio').val();
		if(order_by_num == 7 || !order_by_num){
			$('#ratio').addClass('arrow_up');
			$('#order_ratio').val(8);
		}else{
			$('#ratio').addClass('arrow_down');
			$('#order_ratio').val(7);
		}
		$('#my_order').val($('#order_ratio').val());
		
		search_all.submit();
	}
	
	function search_my(){
		$('#derive').val(2);
	}
	
	function derive_go(){
		$('#derive').val(1);
		search_all.submit();
	}
</script>
	<div class="content">
		<div class="nav_page">安智合作运营平台>收入统计</div>
		<div class="search_box">
		  <form method="get" action="__URL__/income_statistics" name="search_all">
				<table cellpadding="0" cellspacing="0" class="search_table">
					<tbody>
						<tr>
							<td width="18%">负责人：　
							  <select name="charge">
								<option value="0">请选择...</option>
								<?php foreach($charge_result as $key => $val){ ?>
								<option value="{$val.id}" <?php if($val['id'] == $charge){ ?>selected<?php } ?>>{$val.charge_name}</option>
								<?php } ?>
							  </select>
							</td>
							<td width="18%">渠道类型：
						  		<select name="channel_type"  style="width:120px">
									<option value="0">请选择...</option>
									<?php foreach($channel_category as $key => $val){ ?>
										<option value="{$val.category_id}" <?php if($channel_type == $val['category_id']){ ?>selected<?php } ?>>{$val.name}</option>
									<?php } ?>
								</select>
							</td>
							<td width="40%">收入类型：
							  <select name="income_type" style="width:120px;">
								<option value="0">请选择...</option>
								<option value="1" <?php if($income_type == 1){ ?>selected<?php } ?>>安智市场激活</option>
								<option value="2" <?php if($income_type == 2){ ?>selected<?php } ?>>广告分成收入</option>
								<option value="4" <?php if($income_type == 4){ ?>selected<?php } ?>>游戏分成收入</option>
							  </select>
							</td>
							<td width="24%">&nbsp;</td>
						</tr>
						<tr>
							<td>渠道名称：
							  <input type="text" class="search_item_text" name="channel_name" value="{$channel_name}" /></td>
							<td>账号名称：
                            <input  type="text" class="search_item_text" name="account_name" value="{$account_name}" /></td>
							<td>报表日期：
                              <input id="start_tm" name="start_tm" style="cursor: hand; width: 100px; height:28px; border:1px solid #dcdcdc" value="{$start_tm}" size="15" type="text" /><img src="/Public/js/calendar.gif" onclick="return showCalendar('start_tm', 'y-m-d');" style="margin: 1px; cursor: hand;" width="16px" align="absmiddle" height="15px" /> 至 <input id="end_tm" name="end_tm" style="cursor: hand; width: 100px; height:28px; border:1px solid #dcdcdc" value="{$end_tm}" size="15" type="text" /><img src="/Public/js/calendar.gif" onclick="return showCalendar('end_tm', 'y-m-d');" style="margin: 1px; cursor: hand;" width="16px" align="absmiddle" height="15px" /></td>
							<td><input type="submit" onclick="search_my();" value="搜索"  class="search_btn"/></td>
							<td><input type="hidden" id="my_order" name="order_by_num" value="{$order_by_num}" /></td>
							<td><input type="hidden" id="derive" name="derive" /></td>
						</tr>
					</tbody>
				</table>
		  </form>
		</div>
		<br />
		<div class="tablelist_box">
			<div class="tablelist_btns"><span class="search_btn"><a href="javascript:;" onclick="derive_go();">导出报表</a></span></div>
			<table cellpadding="0" cellspacing="0" class="table_list">
				<thead>
					<tr>
						<th width="10%">日期</th>
						<th width="8%">渠道名称</th>
						<th width="10%">渠道类型</th>
						<th width="9%">账号名称</th>
						<th width="11%">负责人</th>
						<th width="11%">收入类型</th>
						<th width="8%"><a href="javascript:;" onclick="order_by_deduct();">扣量前<span id="pre_deduct"></span><input type="hidden" value="{$order_by_num}" id="order_deduct" /></a></th>
						<th width="9%"><a href="javascript:;" onclick="order_by_income();">原收入<span id="income"></span><input type="hidden" value="{$order_by_num}" id="order_income" /></a></th>
						<th width="9%"><a href="javascript:;" onclick="order_by_nincome();">新收入<span id="nincome"></span><input type="hidden" value="{$order_by_num}" id="order_nincome" /></a></th>
						<th width="9%"><a href="javascript:;" onclick="order_by_ratio();">扣量比例<span id="ratio"></span><input type="hidden" value="{$order_by_num}" id="order_ratio" /></a></th>
					</tr>
				</thead>
				<tbody>
					<?php foreach($result as $key => $val){ ?>
					<tr>
						<td><?php echo date('Y-m-d',strtotime($val['theday'])); ?></td>
						<td><a href="__URL__/income_statistics/channel_name/{$val.chname}" class="blue">{$val.chname}</td>
						<td>{$val.category_name}</td>
						<td><a href="__URL__/income_statistics/account_name/{$val.user_name}" class="blue">{$val.user_name}</td>
						<td><a href="__URL__/income_statistics/charge_name/{$val.charge_name}" class="blue">{$val.charge_name}</a></td>
						<td><?php if($val['type'] == 1){ ?><input type="checkbox" disabled <?php if($val['income_show_type'] == 1 || $val['income_show_type'] == 3 || $val['income_show_type'] == 5 || $val['income_show_type'] == 7){ ?>checked<?php } ?> /> 安智市场激活<?php }elseif($val['type'] == 2){ ?><input type="checkbox" disabled <?php if($val['income_show_type'] == 2 || $val['income_show_type'] == 3 || $val['income_show_type'] == 6  || $val['income_show_type'] == 7 ){ ?>checked<?php } ?> /> 广告分成收入<?php }elseif($val['type'] == 4){ ?><input type="checkbox" disabled <?php if($val['income_show_type'] == 4 || $val['income_show_type'] == 5 || $val['income_show_type'] == 6 || $val['income_show_type'] == 7 ){ ?>checked<?php } ?> /> 游戏分成收入<?php } ?></td>
						<td>{$val.before_deduct_income}</td>
						<td>{$val.income_num}</td>
						<td>{$val.new_income}</td>
						<td>{$val.deduct_ratio}%</td>
						
					</tr>
					<?php } ?>
				</tbody>
			</table>
			<div class="pagebars">
				<table cellpadding="0" cellspacing="0" width="100%">
					<td class="pagebars_right right">
					  {$page}
					</td>
				</table>
			</div>
		</div>
		<div class="table_infors">
			<p>注：<br/>1、扣量前：系统计算出未扣量的的原始收入数据<br/>2、原收入：系统计算出已扣量的收入数据<br/>3、新收入：最终展现在合作方前台的收入数据<br/>4、扣量比例=（扣量前-新收入）/扣量前<br/>
5、导出报表：当前报表导出为csv
			</p>
		</div>
	</div>
	<div class="clear"></div>

<!--content end-->

</body>
</html>
