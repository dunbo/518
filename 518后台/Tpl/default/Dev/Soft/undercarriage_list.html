{// 加载头部公共文件 }
<include file="../../Public/header" />
<style>
.intb td {
border-right:none;
border-bottom: none;
}
.fixlong {
  table-layout: fixed;
}
.fixlong td {
  word-break: break-all;
}
</style>
<link rel="stylesheet" href="/Public/css/thickbox.css" type="text/css" media="screen" />
<script type="text/javascript" src='/Public/js/thickbox-compressed.js'></script>
<script type="text/javascript" src='/Public/js/soft.js'></script>
<link rel="stylesheet" type="text/css" href="/Public/img/common.css" />
{//时间插件开始}
<script type="text/javascript" src="/Public/js/My97DatePicker/WdatePicker.js"></script>
{//时间插件结束}
<script type="text/javascript" src="__PUBLIC__/school/js/jquery.zxxbox.3.0.js"></script>
<link rel="stylesheet" href="/Public/css/jquery.autocomplete.css" type="text/css" media="screen" />
<script type="text/javascript" src="__PUBLIC__/js/jquery.autocomplete.js"></script>
<div class="main" >
<div class="content">
<center>
<form method='get' action="__URL__/undercarriage_list" >
<table width="100%" height="39" border="0" cellpadding="0" cellspacing="0" class="tb">
  <tr>
    <td width="99">软件ID：</td>
    <td width="100"><input size='9' type="text" name="softid" id="softid" value="{$softid}" /></td>
    <td width="99">软件名称：</td>
    <td width="100"><input size='9' type="text" name="softname" id="softname"  value="{$softname}" /></td>
	<td width="99">软件包名：</td>
    <td width="100"><input size='9' type="text" name="package" id="package"  value="{$package}" /></td>
	<td width="99">开发者名称：</td>
    <td width="100"><input size='9' type="text" name="dev_name" id="dev_name" value="{$dev_name}" /></td>
    <td width="99">注册邮箱：</td>
    <td width="100"><input size='9' type="text" name="email" id="email"  value="{$email}" /></td>
	<td width="99">开发者类型：</td>
    <td width="100">
	<select id="dev_type" name="dev_type">
		<option value="" selected="selected" >全部</option>
		<option value="0"<if condition="$dev_type eq '0'">selected="selected"</if>>公司</option>
		<option value="1"<if condition="$dev_type eq '1'">selected="selected"</if>>个人</option>
	</select></td>
	<td width="100" rowspan="3" align="center"><input type="submit" name="button" id="button" value="&nbsp;搜 索&nbsp;"  onclick="return checkinput()" /></td>
  </tr>
  <tr>
	<td width="99">角标类型</td>
	<td>
			<select style='width:85px' name="type" id="type">
				<option value="" selected="selected">全部</option>
				<volist name='sj_corner_mark' id='m'>				
				<option value="{$m.id}" <if condition="$type == $m['id']">selected="selected"</if>>{$m.name}</option>
				</volist>		
			</select>
	</td>
	<td width="99">起止日期：</td>
    <td width="300" colspan='4'><?php showDatePicker('begintime','endtime', $begintime,$endtime);?></td>
	<td>下载量：</td>
	<td colspan='2'><input type="text" name="uplode" id="uplode" value="{$uplode}" style="cursor: hand; width: 55px;"/>~
	<input type="text" name="uplode1" id="uplode1" value="{$uplode1}" style="cursor: hand; width: 55px;"/></td>				
	<td >官方认证</td>
	<td>
		<select style='width:85px' name="Official" id="Official ">
			<option value="">请选择</option>
			<option value="1" <if condition="$Official  eq '1'">selected</if>>是</option>
			<option value="2" <if condition="$Official  eq '2'">selected</if>>否</option>
		</select>
	</td>
  </tr>
  <tr>
	<td >TV认证</td>
	<td>
		<select style='width:85px' name="TV" id="TV ">
			<option value="">请选择</option>
			<option value="1" <if condition="$TV  eq '1'">selected</if>>已认证</option>
			<option value="2" <if condition="$TV  eq '2'">selected</if>>未认证</option>
			<option value="3" <if condition="$TV  eq '3'">selected</if>>忽略</option>
			<option value="4" <if condition="$TV  eq '4'">selected</if>>历史认证</option>
		</select>
	</td>
	<td >软件来源：</td>
	<td>
		<select style='width:85px' name="soft_source" id="soft_source ">
			<option value="">请选择</option>
			<option value="0" <if condition="$soft_source  eq '0'">selected</if>>未知</option>
			<option value="1" <if condition="$soft_source  eq '1'">selected</if>>安智上传</option>
			<option value="2" <if condition="$soft_source  eq '2'">selected</if>>开发者上传</option>
			<option value="3" <if condition="$soft_source  eq '3'">selected</if>>采集</option>
			<option value="4" <if condition="$soft_source  eq '4'">selected</if>>批量上传</option>
		</select>
	</td>
	<td >安全状态：</td>
	<td>
		<select style='width:85px' name="safe" id="safe ">
			<option value="0" <if condition="$safe  eq '0'">selected</if>>全部</option>
			<option value="1" <if condition="$safe  eq '1'">selected</if>>安全</option>
			<option value="2" <if condition="$safe  eq '2'">selected</if>>不安全</option>
		</select>
	</td>
	<td width="99">开发者ID:</td>
    <td width="100"><input size='9' type="text" name="dev_id" id="dev_id"  value="{$dev_id}" /></td>
	<td align="center">屏蔽状态：</td>
	<td>
		<select style='width:85px' name="shield_status" id="shield_status ">
			<option value="" <if condition="$shield_status  eq ''">selected</if>>全部</option>
			<option value="1" <if condition="$shield_status  eq '1'">selected</if>>屏蔽</option>
			<option value="2" <if condition="$shield_status  eq '2'">selected</if>>正常</option>
		</select>
	</td>
	<td width="100" ><button type="button" onclick="openw();" >软件类型</button></td>
	<td width="100" ></td>		
</tr>
<tr>
<td colspan='3'><button type="button" onclick="open_ad();" >广告类型</button><input type="text" name="ad_type" id="ad_type" value="{$ad_str}"></td>
</tr>
</table>
<input type='hidden' name='ad_id' id='ad_id' value="{$ad_id_str}"/>
<input type='hidden' name='cateid' id='cateid' value="{$init_cateid}"/>
</form>
<br />
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr align='left' bgcolor="" height='30'><td colspan='7'>{$total}条记录</td></tr>
</table>
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="tb fixlong">
  <tr>
	<td width="5%" bgcolor="#e3e2fe"><input type="checkbox" id="id_all[]" name="id_all[]" onclick="selectAlls();"></td>
    <td align='center' width="25%" height="30" bgcolor="#e3e2fe" > <font style="color:#000; font-weight:bold">软件信息</font></td>
    <td align='center' width="20%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">开发者</font></td>
	
    <td align='center' width="10%" height="30" bgcolor="#e3e2fe">
	<a href='__URL__/undercarriage_list/orderby/download/order/d/?{$param}'>
	<font style="color:#000; font-weight:bold">下载量
<if condition="$orderby == 'download'">		
	<if condition="$order eq 'a'">&darr;<else/>&uarr;</if>
</if>	
	</font></a></td>
    <td align='center' width="15%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">广告扫描</font></td>
		
    <td align='center' width="12%" height="30" bgcolor="#e3e2fe">
	<font style="color:#000; font-weight:bold">下架原因</font></td>
	
    <td align='center' width="8%" height="30" bgcolor="#e3e2fe">
	<a href='__URL__/undercarriage_list/orderby/time/order/a/?{$param}'>
	<font style="color:#000; font-weight:bold">下架时间
<if condition="$orderby != 'download'">		
	<if condition="$order1 eq 'd'">&uarr;<else/>&darr;</if>
</if>	
	</font></a></td>
    <td align='center' width="7%" height="30" bgcolor="#e3e2fe"><font style="color:#000; font-weight:bold">操作</font></td>
  </tr>
  <volist name='list' id='softlist'>
  <tr id='tr{$softlist.softid}'  onclick="onc_('{$softlist.softid}');">
	<td align='left'><input type="checkbox" name="id[]" value="{$softlist.softid}" /><br/><br/>
	{$softlist.softid|default=''}<br/><br/>
	<img src='<?php echo IMGATT_HOST;?>{$softlist.iconurl}' width="48" height="48"/> 
	</td>
	<td align='left'>
	<!--<a target='_blank'  href='__URL__/soft_view/softid/{$softlist.softid}/'>-->
	<b>{$softlist.softname}</b>
	<!--</a>-->
	<br/>
	<font style="color:#009600">{$softlist.package}<br/>
	{$softlist.category_name}&nbsp;&nbsp;<br/>	
	<if condition="$softlist.setOfficial eq 1">官方</if>
	<br/></font>
	<if condition="$softlist.language eq 1">中文<elseif condition="$softlist.language eq 2 " />英文 <else /> 其他 </if>|
	<if condition="$softlist.update_type eq 2">开发者
	<elseif condition="$softlist.update_type eq 1" />
	安智上传
	<elseif condition="$softlist.update_type eq 3" />
	采集
	<elseif condition="$softlist.update_type eq 4" />
	批量上传
	<else/>
	未知
	</if>|{$softlist.Angle_type}|&nbsp;版本名：{$softlist.version}|
	<if condition="$softlist.shield eq 1"><font style="color:red">屏蔽</font></if><br/>
	abi：<volist name='softlist.abis' id='abi'> {$abi}</volist>
	<if condition="$softlist.safe gt '1'">
	<a href="javascript:;" onclick="scan_res('{$softlist.softid}');">
	<font style="color:red">不安全</font>
	</a>
	</if>
	</td>
	<!------------不安全信息-------------->
	<div id="scan_res{$softlist.softid}" style="padding:20px; width:250px;  display:none; word-break:break-all; word-wrap:break-word;">
	{$softlist.scan_result}<br/>
	{$softlist.scan_result1}
	</div>	
	<!-------------不安全信息结束--------->
	
    <td  align='left' style="vertical-align:top;">	
	<if condition="$softlist.dev_id neq '' and $softlist.dev_id neq 0">
	<!----------通过---------->
	<if condition="$softlist.dev_status eq 0">
	<a target='_blank' href='/index.php/Dev/User/userlists/dev_id/{$softlist.dev_id}'>
	<!----------审核中---------->
	<elseif condition="$softlist.dev_status eq 1" />
	<a target='_blank' href='/index.php/Dev/User/auditforuser/dev_id/{$softlist.dev_id}'>
	<!----------驳回---------->
	<elseif condition="$softlist.dev_status eq '-1' " />
	<a target='_blank' href='/index.php/Dev/User/reject_users/dev_id/{$softlist.dev_id}'>
	<!----------屏蔽---------->
	<elseif condition="$softlist.dev_status eq '-2' " />
	<a target='_blank' href='/index.php/Dev/User/shield_users/dev_id/{$softlist.dev_id}'>
	</if>
	{$softlist.dev_name|default=''}</a><br />
	{$softlist.dev_id|default=''}<BR/>
	<p><if condition="$softlist.dev_type eq 0">公司<p/>
	<p><elseif condition="$softlist.dev_type eq 1" />个人<p/>
	<p><else/>&nbsp;</if><p/>
	<a target='_blank' href='__URL__/undercarriage_list/email/{$softlist.dever_email}'>	
	{$softlist.dever_email|default=''}
	</a>
	<elseif condition="$softlist.dev_id eq '' or  $softlist.dev_id eq 0"/>
	{$softlist.dev_name_soft}
	</if>
	</td>
	<td align='left' style="vertical-align:top;">
	<?php if($div_no_show == 1) { ?>
		{$softlist.total_downloaded|default='0'}
	<?php }else{ ?>
		总量： {$softlist.total_downloaded|default='0'}<br/>
		扣量：-{$softlist.total_downloaded_detain|default='0'}<br/>
		增量: +{$softlist.total_downloaded_add|default='0'}<br/>
		剩余量: {$softlist.total_downloaded_surplus|default='0'}<br/>
		状态: <?php 
				if($softlist['package_hidden_downloads']['is_hidden']==1){
					echo '隐藏';
				}else{
					echo '显示';
				} 
				?>
		<br/>
	<?php } ?>		
	</td>
	
	<td align='left' style="vertical-align:top;">
	<if condition="$softlist.advertisement neq ''">
	<a href="javascript:;" onclick="openad('{$softlist.softid}');">
	{$softlist.advertisement|msubstr=###,0,20}<br/>【安智扫描】<br/>
	</if>
	<if condition="$softlist.scan neq ''">
	<a href="javascript:;" onclick="open_scan('{$softlist.softid}');">
	{$softlist.scan|msubstr=###,0,22}</a><br/>
	</if>	
	<if condition="$softlist.scan1 neq ''">
	<a href="javascript:;" onclick="open_scan1('{$softlist.softid}');">
	{$softlist.scan1|msubstr=###,0,22}</a>
	</if>
	</td>
	<div id="ad_{$softlist.softid}" style="padding:20px; width:250px; display:none; word-break:break-all; word-wrap:break-word;">
		{$softlist.advertisement}<br/>【安智扫描】<br/>
	</div>		
	<div id="scan_{$softlist.softid}" style="padding:20px; width:250px;  display:none; word-break:break-all; word-wrap:break-word; ">
		{$softlist.scan}<br>
	</div>	
	<div id="scan1_{$softlist.softid}" style="padding:20px; width:250px;   display:none; word-break:break-all; word-wrap:break-word;">
		{$softlist.scan1}<br>
	</div>
	
	<td align='left' >
	<div style="height:120px; overflow-x:auto; overflow-y:auto">
	<if condition="$softlist.reason neq ''">
	{$softlist.reason|default=''}
	<elseif condition="$softlist.deny_msg neq ''" />
	<a href="javascript:;" onclick="open_msg('{$softlist.softid}');">
	{$softlist.last_refresh|default=''}<br>
	{$softlist.deny_msg|msubstr=###,0,50}
	</a>
	</if>
	</div>
	</td>
	
	<div id="msg_{$softlist.softid}" style="padding:20px; width:250px;   display:none; word-break:break-all; word-wrap:break-word;">
		{$softlist.last_refresh|default=''}<br>
		{$softlist.deny_msg}
	</div>
	
	
		
	<td align='center' >
	<div style="width:70px;">
	{$softlist.last_refresh|default=''}
	</div>
	</td>
	
    <td width='100px' align="center" valign="middle">
	<if condition="$softlist.safe lt '2'">
	<button  onclick="shelves_pre('{$softlist.softid}')" >&nbsp;上&nbsp;架&nbsp;</button>
	</if>
		<p style="padding-bottom: 8px;"></p>
	<button  onclick="soft('/index.php/Dev/Apk/mod_line/type/mod_line/softid/{$softlist.softid}')">&nbsp;编&nbsp;辑&nbsp;</button>
	</td>
  </tr>
  </volist>
  <tr height='50px'>
	<td align='left' colspan='8'>
	<input type="checkbox" id="id_all[]" name="id_all[]" onclick="selectAlls();">
	<button onclick="shelves_str()">批量上架</button>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<button onclick="shield_soft('undercarriage_shield');">&nbsp;&nbsp;屏&nbsp;&nbsp;蔽&nbsp;&nbsp;</button>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<button onclick="hidden_downloads_arr();">隐藏下载量</button>
	</td>
  </tr>
</table>
<div  align='left'>{$page}</div>
</center>
</div>
</div>
<div id="shelves_div" style="display:none;width:300px;height:150px;padding:10px">
	<div style="font-size:15px;font-weight:bold">
		确定执行此操作？
	</div>
	<div style="margin-top:10px">
		备注：
		<textarea id="beizhu" rows="4" cols="40"></textarea>
		<input type="hidden" id="shelves_id">
	</div>
	<div style="margin-top:10px;margin-right:14px;text-align:right">
		<input type="button" value="确定" onclick="shelves()">&nbsp;&nbsp; &nbsp; &nbsp;<input type="button" value="取消" onclick="$.zxxbox.hide();">  
	</div>
	
</div>
<!-- 软件编辑/升级,开始 -->
<form method='post' action='' id='tmp_form'>
<input type='hidden' name='referer' id='referer' value='' />
</form>
<div id="hidden_downloads" class="zxx_test_list" style="padding:10px; width:200px; height:150px;   display:none;">
	<table>
	<tr><td align='left'><h2>下载量显示状态：</h2></td></tr>
	<tr><td align='left'>隐藏后，将在我的软件列表隐藏下载量数值及弹窗</td></tr>
	</table>
	<br/>
	&nbsp;&nbsp;&nbsp;&nbsp;
	<input type="radio" name='hidden_downloads_type' value='0'/>显示
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<input type="radio" name='hidden_downloads_type' value='1'/>隐藏
	<input type="hidden" value="" name="hidden_tmp_softids" id='hidden_tmp_softids'>
	<br/><br/>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<td><button  onclick="hidden_downloads_do();">提交</button></td>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<td><button  onclick="zxxbox_hide();">取消</button></td> 
</div>
<script type="text/javascript">
//隐藏下载量弹窗
function hidden_downloads_arr(){
	id_str = Selected_check();
	if(id_str){
		$('#hidden_tmp_softids').val(id_str);
		$("#hidden_downloads").zxxbox();  
		open_color(id_str);
	}
}
//隐藏下载量
function hidden_downloads_do(){
	var id_str = $('#hidden_tmp_softids').val();
	$("[name='hidden_downloads_type']").each(function(){
		if($(this).is(':checked')) {
			only_type = $(this).val();
		}
	});
	$.ajax({
		url: '__URL__/update_hidden_downloads/tmp_softids/'+id_str+'/only_type/'+only_type,
		data: '',
		type: 'get',
		dataType: 'json',
		success: function(ret) {
			if(ret['code']==0) {	//失败
				alert(ret['msg']);
				//location.reload();//加载页面
				return false;
			} else if(ret['code']==1) {	//成功
				$.zxxbox.hide();
				//变灰不可点击处理
				gray_processing(ret['msg']);
			}
		}
	});
} 
var data = [{$alladlist}];
$("#ad_type").autocomplete(data);
$("#ad_type").blur(function(){
	var chkobj =  $("input[name='catadid[]']");
	var len = chkobj.length;
	var ids = '';
	var ad_id_arr = new Array();
	var ad_str = $('#ad_type').val();
	var now_id = '';
	ad_id_arr = ad_str.split(',');
		$("input[name='catadid[]']").each(function(i){
			$(this).attr('checked',false);
			//chkobj[a].checked = false;
			if($('#ad_type').val()){
				if($.inArray($(this).next().html(),ad_id_arr)!='-1'){
					$(this).attr('checked',true);
					now_id += $(this).val()+',';			
					$('#ad_id').attr("value",now_id);
				}
			}else{
				$('#ad_id').val('');
			}
			
		});
});
function soft(url) {
	$('#tmp_form')[0].action = url;
	$('#referer').val(location.href);
	$('#tmp_form').submit();
	if(window.ActiveXObject) window.event.returnValue = false;
}
</script>
<!-- 软件编辑/升级,结束 -->

<script type="text/javascript">

function open_msg(id){	
	$("#msg_"+id).zxxbox();
}
function openad(id){	
	$("#ad_"+id).zxxbox();
}
function open_scan(id){	
	$("#scan_"+id).zxxbox();
}
function open_scan1(id){	
	$("#scan1_"+id).zxxbox();
}
function scan_res(id){	
	$("#scan_res"+id).zxxbox();
}
//上架
function shelves_pre(id){
	$("#shelves_id").val(id);
	$("#shelves_div").zxxbox();
}
function shelves() {
	var id = $("#shelves_id").val();
	var beizhu = $("#beizhu").val();
	open_color(id);

	if(!id) {
		alert('请选择要通过的对象！');
		return false;
	}
	var buid = '#tr'+id+' td button';
	$(buid).attr({disabled:'disabled', name:'disabled'});
	$.ajax({
		url: '__URL__/shelves/id/'+id+'/beizhu/'+beizhu,
		data: '',
		type: 'post',
		dataType: 'json',
		success: function(ret) {
			if(ret['code']==0) {	//失败
				alert(ret['msg']);
				location.reload();//加载页面
				return false;
			} else if(ret['code']==1) {	//成功
				//变灰不可点击处理
				gray_processing(ret['msg']);
				$.zxxbox.hide();
			}
		}
	});

}
//批量上架
function shelves_str() {
	id_str = Selected_check();
	if(id_str){
		shelves_pre(id_str);
	}
}	
</script>
<!--等待-->
<div id="await" style="padding:10px; display:none;z-index:10011;">
<table border="0" cellpadding="0" cellspacing="0" style="width:100%;height:100%;">
<tr><td><img src="/Public/images/loading.gif" width="32" height="32" border="0" style="vertical-align:middle;text-align:center;" /></td></tr>
</table>
</div>

<!-------//区域选中---------->
<script language="javascript">
var flags = false;
function onc_(id){
	return false;
	if(!flags){
		$("[name='id[]'][value="+id+"]").each(function(){
			$(this).attr('checked',true);
		});
		flags = true;
	}else{	
		$("[name='id[]'][value="+id+"]").each(function(){
			$(this).attr('checked',false);
		});
		flags = false;
	}
}
</script>

<include file="../../Public/category" />
<include file="../../Public/ad_list" />