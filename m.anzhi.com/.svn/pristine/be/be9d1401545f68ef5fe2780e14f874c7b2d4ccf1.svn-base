<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta content="telephone=no" name="format-detection">
<meta name="keywords" content="" />
<meta name="description" content="" />
<title>九宫格抽奖</title>
<link type="text/css" rel="stylesheet" href="<!--{$out.new_static_url}-->/activity/red_ffl/css/common.css?v3"/>
<script type="text/javascript"  src="http://img4.anzhi.com/static/public/js/jquery-1.8.0.min.js"></script>

<script type="text/javascript" src="<!--{$out.new_static_url}-->/activity/red_package/js/soft_list.js?v33"></script>
<script type="text/javascript" src="<!--{$out.new_static_url}-->/activity/ghost_sign_lottery/js/activity_public.js?v4"></script>
<script type="text/javascript" src="<!--{$out.new_static_url}-->/activity/ghost_sign_lottery/js/jquery.easing-1.3.min.js"></script>
<script type="text/javascript" src="<!--{$out.new_static_url}-->/public/js/activity_public3.js"></script>
<!--{if $out['is_share'] == 1}-->
<script type="text/javascript" src="/js/anzhi.js"></script>
<!--{/if}-->
<script type="text/javascript">

</script>
</head>
<body>
<!--{if $out.activity_result['imgurl'] != ''}-->
<div class="banner"><img src="<!--{$out.imgurl}--><!--{$out.activity_result['imgurl']}-->"/></div>
<!--{/if}-->
<!--{if $out.activity_result['imgurl'] == ''}-->
<div class="banner"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/banner.png"/></div>
<!--{/if}-->
<div class="main">
	<div class="lottery_wrap">
		<div class="lottery">
		<div class="lottery_inner">
			<table cellspacing="0" cellpadding="0" id="gameTable">
                <tbody>
					<tr>
	                                        <!--{if $out['prize_results'][0]['type'] == 6}-->
						<td class="game_squ game_squ1"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][0]['type'] == 7}-->
						<td class="game_squ game_squ1"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][1]['type'] == 6}-->
						<td class="game_squ game_squ2"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][1]['type'] == 7}-->
						<td class="game_squ game_squ2"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][2]['type'] == 6}-->
						<td class="game_squ game_squ3"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][2]['type'] == 7}-->
						<td class="game_squ game_squ3"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
					</tr>
					<tr>
	                                        <!--{if $out['prize_results'][7]['type'] == 6}-->
						<td class="game_squ game_squ4"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][7]['type'] == 7}-->
						<td class="game_squ game_squ4"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
						<td class="game_squ game_squ5"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery_btn.png"/></td>
	                                        <!--{if $out['prize_results'][3]['type'] == 6}-->
						<td class="game_squ game_squ6"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][3]['type'] == 7}-->
						<td class="game_squ game_squ6"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
					<tr>
	                                        <!--{if $out['prize_results'][6]['type'] == 6}-->
						<td class="game_squ game_squ7"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][6]['type'] == 7}-->
						<td class="game_squ game_squ7"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][5]['type'] == 6}-->
						<td class="game_squ game_squ8"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][5]['type'] == 7}-->
						<td class="game_squ game_squ8"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][4]['type'] == 6}-->
						<td class="game_squ game_squ9"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/lottery1.png"/></td>
	                                        <!--{/if}-->
	                                        <!--{if $out['prize_results'][4]['type'] == 7}-->
						<td class="game_squ game_squ9"><img src="<!--{$out.new_static_url}-->/activity/red_ffl/images/thanks.png"/></td>
	                                        <!--{/if}-->
					</tr>
				</tbody>
			</table>
			<p><a id="gameBtn" href="javascript:;"></a></p><!--这个就是中间的表情按钮-->  
			</div>
		</div>
	</div>
	
	<div class="draw_txt"><p>您还有<span id="lottery_num"><!--{$out.now_num}--></span>次抽奖机会</p></div>
                <!--<li><p>中奖红包未领取<a href="javascript:;" onclick="open_red(1,2)">立刻领取</a></p></li>-->
	                                        <!--{if $out['noget'] == 1}-->
	<div class="lottery_list">
		<ul>
                    					<!--{foreach from=$out.nogetlist key=mykey  item=v}-->
			<li><p>中奖红包未领取　<!--{date('Y-m-d H:i:s',$v.time)}--> <a class="open_red" href="javascript:;" onclick="open_red(<!--{$v.red_id}-->,<!--{$mykey}-->,'<!--{$v.package}-->',<!--{$v.status}-->)">立刻领取</a></p></li>
                        					<!--{/foreach}-->
			<li class="list_spec"><p>请尽快领取，红包将在1小时后过期</p></li>
		</ul>
	</div>
	                                        <!--{/if}-->
	<div class="soft_wrap" style="display:none;">
		<div class="soft_title">
			<p>抽奖机会：<!--{$out.down_num}-->/<!--{$out.activity_result.red_chance_num}--></p>
			<a href="javascript:;" onclick="change_soft1();">换一批</a>
			<div class="clear"></div>
		</div>
                <ul class="soft-list clear" id="soft-list">
                </ul>
	</div>
	<div class="soft_txt" style="display:none;">
		<p>下载软件可增加抽奖机会，最多可获得<!--{$out.activity_result.red_chance_num}-->次机会！</p>
	</div>
	<div class="rules">
		<h3>规则说明：</h3>
                <ul><li>
                <!--{$out.activity_result.red_at_desc }-->
            </ul></li>
	</div>
</div>
<div class="tip-box2" id="tip-box1" style="display: none;">
	<div class="tip-title">
		<h6>温馨提示</h6>
		<span onclick="cloBox('#tip-box1')"></span>
	</div>
	<div class="tip-con">
		<p>安装“安智市场客户端”才能领取哦~</p>
	</div>
	<p><a href="http://m.anzhi.com"  class="btns_close">去下载</a></p>
</div>

<script type="text/javascript">
	var sid = '<!--{$out.sid}-->',open_num=0;
	var aid = '<!--{$out.aid}-->',p=0,soft_lists_go = [];
	var activity_name = '<!--{$out.activity_result.name}-->';
	var lottery_num = "<!--{$out.lottery_num}-->";
	var is_sing = "<!--{$out.is_sing}-->";
	var is_login = "<!--{$out.is_login}-->";
        var package_arr_task= <!--{$out.package_arr_task}-->;
        var package_arr_task_down= <!--{$out.package_arr_task_down}-->;
        var is_prize=2;

<!--{if $out['is_share'] == 1}-->
//var js_param = {type:'action', id:aid, callback:invite_callback,from:7};
//var php_param = {type:'action', aid:aid,from:7};

var js_param = {type:'action', id:aid,actiontype:5, from:8,callback:invite_callback};
var php_param = {type:'action', aid:aid,actiontype:5, from:8};
$(document).ready(function () {
        //$(".tip-box2").css('display','block');
	share_download(js_param, php_param);
         $('a').removeAttr('onclick');
         $('a').click(function(){
            $(".tip-box2").css('display','block');
        })
});

//分享地址为活动页 用的方法
function invite_callback() {
	if (typeof(arguments[0]) != 'undefined') {
		var magic = arguments[0];
		var version = parseInt(arguments[1]);
		var firmware = arguments[2];
		var flag = arguments[3];
		if(version >= 6500){
			js_param = {type:'action', id:aid, callback:null};
			Azfd.lock = false;
			//share_download(js_param, php_param);			
		}else {
			setTimeout(function(){
				var php_url = '/fast.php?';
				for (var i in php_param) {
					php_url += '&' + i + '=' + php_param[i];
				}
				window.location.href=php_url;			
			},1000);		
		} 
	}else{
		setTimeout(function(){
			var php_url = '/fast.php?';
			for (var i in php_param) {
				php_url += '&' + i + '=' + php_param[i];
			}
			window.location.href=php_url;			
		},1000);		
	}
}

<!--{/if}-->	

$(document).ready(function () {
	setTimeout(function(){
		//go_from 1排行榜（无软件名称、状态按钮） 2抽奖页面（有软件名称、和状态按钮）
		var go_from =2;
		my_soft(aid,sid,6,go_from,package_arr_task,package_arr_task_down);
	}, 500);
	if (lottery_num==0||sid=='')//sid为空 说明不是端内打开
	{
	        <!--{if $out['is_login'] != 2}-->
		$("#gameBtn").hide(); //开始后隐藏开始按钮
		$("#gameBtn").parent().addClass("waitGame");
	        <!--{/if}-->	
	}
});

function change_soft1(){
    change_soft(aid,sid,6,2);
}

/*
function onLoginComplete(sid,tip){
	sid_str = sid.replace("PHPSESSID=", "");
	location.href="/lottery/red_package/index.php?sid="+sid_str+"&aid=<!--{$out.aid}-->";
}*/

function onAccountChanged(json){
    var data = JSON.parse(json);
    var sid = data.sessionId;
    location.href="/lottery/red_package/index.php?sid="+sid+"&aid=<!--{$out.aid}-->";
}
</script>


<script type="text/javascript">
//抽奖

gameTable = document.getElementById("gameTable");


$("#gameBtn").click(function () {
        <!--{if $out['is_share'] != 1}-->
	<!--{if $out['is_login'] == 2}-->
	login('<!--{$out.login_url}-->','<!--{$out.version_code}-->');
	return false;
	<!--{/if}-->	
	if(lottery_num <= 0 ){
                window.AnzhiActivitys.showToastForJs("抽奖次数已用完");
		return false;	
	}
	$(this).hide(); //开始后隐藏开始按钮
	$(this).parent().addClass("waitGame");
	click_lottery();
	<!--{/if}-->	
});
function click_lottery(){
	$.ajax({
		url: '/lottery/red_package/lottery_do.php',
		data:'sid='+sid+'&aid='+aid,
		type: 'post',
		dataType: 'json',				
		success:function(res){
			if(res[0] == -1){
				lottery_num = lottery_num-1;
				$('#lottery_num').html(lottery_num);

				if(res[2]==8){
				    res[2] =0;
				}

				//cirle_go(200,res[2]);
				cirle_go(200,parseInt(res[2]));
                                is_prize=2;

                                /*
				setTimeout(
					function(){
                                            var o='{"type":0,"activityId":'+aid+',"status":"3","activityName":"'+activity_name+'"}';
                                            window.AnzhiActivitys.openRedPack(o);
                                            //window.AnzhiActivitys.showToastForJs("抱歉，您未中奖");
					},6000
				);*/
                        }else{
                                is_prize=1;
				if(res[0]==8){
				    res[0] =0;
				}
				cirle_go(200,parseInt(res[0]));
                                //res[4]; 红包id todo

				setTimeout(
					function(){
                                            open_red(res[4],res[5],res[6],0);
                                            $("#gameBtn").parent().removeClass("waitGame");
                                            $("#gameBtn").show(); //停止后显示开始按钮
					},6000
				);

                            //红包弹框//todo
                        }
                    //$("#gameContent p").removeClass("waitGame");
                    //$("#gameBtn").show(); //停止后显示开始按钮
                        
		}
	});
}

function end_game(){
    if(is_prize==2){
	    $("#gameBtn").parent().removeClass("waitGame");
            $("#gameBtn").show(); //停止后显示开始按钮
            var o='{"type":0,"activityId":'+aid+',"status":"3","activityName":"'+activity_name+'"}';
            window.AnzhiActivitys.openRedPack(o);
    
    }
}

    function Star(num) {
        gameTable.rows[arr[index][0]].cells[arr[index][1]].style.border = "";
        gameTable.rows[arr[index][0]].cells[arr[index][1]].style.backgroundImage = "url('<!--{$out.new_static_url}-->/activity/red_ffl/images/cj_light.png')";
        gameTable.rows[arr[index][0]].cells[arr[index][1]].style.backgroundRepeat = "no-repeat";
        gameTable.rows[arr[index][0]].cells[arr[index][1]].style.backgroundSize = "100% 100%";
		//1px solid pink
		//"pink";
        if (index > 0) {
            prevIndex = index - 1;
        }
        else {
            prevIndex = arr.length - 1;
        }
        gameTable.rows[arr[prevIndex][0]].cells[arr[prevIndex][1]].style.border = "";
        gameTable.rows[arr[prevIndex][0]].cells[arr[prevIndex][1]].style.background = "";		
		//1px solid #ffdd99
		//#fff9ed
        index++;
        quick++;

        if (index >= arr.length) {
            index = 0;
            cycle++;
        }

        //跑马灯变速
        if (flag == false) {
            //走五格开始加速
            if (quick == 5) {
                clearInterval(Time);
                Speed = 50;
                Time = setInterval(Star, Speed);
            }
            //跑N圈减速
            if (cycle == EndCycle + 3 && index == EndIndex) {
                clearInterval(Time);
                Speed = 300;
                flag = true;        //触发结束
                Time = setInterval(Star, Speed);
            }
        }
		var stopNums = getCookie('stopNum');
        if (flag == true && index == stopNums - 1) {
			
            quick = 0;
            clearInterval(Time);
            //$("#gameContent p").removeClass("waitGame");
	    //$("#gameBtn").parent().removeClass("waitGame");
            //$("#gameBtn").show(); //停止后显示开始按钮
            end_game();
        }

    }

//结果回调：签到结果、拆红包结果（活动or签到）
function reportPacketResult(json){
    var data = JSON.parse(json);
    if(data.type==2){
        if(data.result==2||data.error==-5){
            //将未领取干掉
        
            $.ajax({
                    url: '/lottery/red_package/index.php',//将已过滤的无效数据清除
                    data:'sid='+sid+'&aid='+aid+'&orderid='+data.orderId,
                    type: 'post',
                    dataType: 'json',				
                    success:function(res){
                        //var o='{"type":0,"activityId":'+aid+',"redPackId":'+red_id+',"LRTS":"1","status":"'+open_status+'","activityName":"'+activity_name+'","APP_INFO":'+res+',"orderId":'+order_id+'}';
                        location.reload();
                        //window.AnzhiActivitys.openRedPack(o);
                    }
            });

        }else{
            location.reload();
        }
    }
}

function open_red(red_id,order_id,ppackage,open_status){
    $(".open_red").removeAttr("onclick");

    //ppackage='com.guo.studenttimetkebiao';
        //if(typeof(ppackage)!='undefined'){
        if(ppackage!=''){//有任务
            $.ajax({
                    url: '/lottery/red_package/index.php',//获取软件信息
                    data:'sid='+sid+'&aid='+aid+'&ppackage='+ppackage,
                    type: 'post',
                    dataType: 'json',				
                    success:function(res){
                        if(res =='""'){
                            open_status=3;
                        }
                        var o='{"type":0,"activityId":'+aid+',"redPackId":'+red_id+',"LRTS":"1","status":"'+open_status+'","activityName":"'+activity_name+'","activityType":"5","APP_INFO":'+res+',"orderId":'+order_id+'}';
                        window.AnzhiActivitys.openRedPack(o);
                    }
            });
        }else{
            //直接弹
            var o='{"type":0,"activityId":'+aid+',"redPackId":'+red_id+',"LRTS":"1","status":"0","activityName":"'+activity_name+'","activityType":"5","orderId":'+order_id+'}';
            window.AnzhiActivitys.openRedPack(o);
        }
}

function go_softinfo_down(softid,my_package,softname,versioncode,size,aid,sid,details){
	<!--{if $out['is_login'] == 2}-->
	login('<!--{$out.login_url}-->','<!--{$out.version_code}-->');
	return false;
	<!--{/if}-->	
            if($('#'+softid).text()=='下载'){
                $('#'+softid).text("等待中");
            }

	$.ajax({
		url: '/lottery/red_package/download_soft.php',
		data:"softid="+softid+"&sid="+sid+"&aid="+aid+"&pkgname="+my_package, 
		type:"post",
		success:function(data) {
			if(details == 1){
				details =1;
			}else{
				details = 0
			}
			window.AnzhiActivitys.downloadForActivity(parseInt(aid),softid,my_package,softname,versioncode,size,details);
		},
	});
}


</script>
</body>
</html>
